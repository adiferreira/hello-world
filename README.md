hello-world
===========

Just a test

To be done later!

Oracle Test DB: adiferreir/^(b**)ba^(*)ifaBinhan4
Oracle Prod DB: adiferreir/3UdBHaSh

-- ####################################################################

## AWS Git Credential:
===================
User Name:	aferreira-at-504017189905
Password:	LnQ1ogcZTt68K2SHWi9URt7ln4YKV+/wUDiEyIK11WE=

Path of cloned AWS project to test the build: C:\Users\aferreir\tutorial-workspace\build-test-aws-clone\pos-unico-rest-service

clone url: https://git-codecommit.eu-central-1.amazonaws.com/v1/repos/pos-unico-rest-service

-- #####################################################################

## Maven install local jar:
==========================
mvn install:install-file -Dfile=ojdbc7.jar -DgroupId=com.oracle -DartifactId=ojdbc7 -Dversion=12.1.0.2 -Dpackaging=jar

----------------

## Jakarta-ee Maven generate project:
mvn archetype:generate -DarchetypeGroupId=org.eclipse.starter -DarchetypeArtifactId=jakartaee10-minimal -DarchetypeVersion=1.1.0 -DgroupId=org.eclipse.rest -DartifactId=rest-service -Dversion=1.0.0-SNAPSHOT

-- ######################################################################

CREATE TABLE WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT (
	ID_RECORD 			NUMBER(6) NOT NULL,
	CODICE_RISTORATORE  NUMBER(6),
	CODICE_GESTORE 		VARCHAR2(2),
	DATA_INSERIMENTO	DATE,
	DATA_INIZIO			DATE,
	DATA_FINE			DATE
);

-- ALTER TABLE WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT ADD CONSTRAINT DAY_RISTORATORI_GESTORI_DEMAT_PK PRIMARY KEY(ID_RECORD);

CREATE PUBLIC SYNONYM DAY_RISTORATORI_GESTORI_DEMAT FOR WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT;

----------------------------------------------

CREATE TABLE WEBSVC_ADM.DAY_SOTTOGESTORI_DEMAT_NCR (
	CODICE_GESTORE		VARCHAR2(2) NOT NULL,
	DATA_INSERIMENTO	DATE
);

ALTER TABLE WEBSVC_ADM.DAY_SOTTOGESTORI_DEMAT_NCR ADD CONSTRAINT DAY_SOTTOGESTORI_DEMAT_NCR_PK PRIMARY KEY(CODICE_GESTORE);

CREATE PUBLIC SYNONYM DAY_SOTTOGESTORI_DEMAT_NCR FOR WEBSVC_ADM.DAY_SOTTOGESTORI_DEMAT_NCR;

----------------------------------------------

CREATE TABLE WEBSVC_ADM.DAY_FP_CODICI_GESTORE (
	CODICE_GESTORE_FP	VARCHAR2(2) NOT NULL,
	CODICE_GESTORE_DAY	VARCHAR2(2) NOT NULL
);

ALTER TABLE WEBSVC_ADM.DAY_FP_CODICI_GESTORE ADD CONSTRAINT DAY_FP_CODICI_GESTORE_PK PRIMARY KEY(CODICE_GESTORE_FP);

CREATE PUBLIC SYNONYM DAY_FP_CODICI_GESTORE FOR WEBSVC_ADM.DAY_FP_CODICI_GESTORE;

----------------------------------------------

CREATE OR REPLACE FUNCTION WEBSVC_ADM.WEBSVC_FCT_COD_GEST_CALLER(
	IN_CODICE_SERVIZIO IN VARCHAR2,
	IN_INDIRIZZO_IP_CHIAMANTE IN VARCHAR2)
	
    RETURN VARCHAR2
IS
    CODICE_GESTORE VARCHAR(2);
    
BEGIN
    SELECT SRC_CODICE_GESTORE
    INTO CODICE_GESTORE
    FROM WEBSVC_ADM.WEBSVC_SOURCE
    WHERE SRC_CODICE_SERVIZIO = IN_CODICE_SERVIZIO AND SRC_IPADDRESS = IN_INDIRIZZO_IP_CHIAMANTE;
    
   RETURN CODICE_GESTORE;
END;
/

CREATE PUBLIC SYNONYM WEBSVC_FCT_COD_GEST_CALLER FOR WEBSVC_ADM.WEBSVC_FCT_COD_GEST_CALLER;

----------------------------------------------

CREATE OR REPLACE PROCEDURE WEBSVC_ADM.WEBSVC_PRC_CHECK_COD_GEST(
	IN_CODICE_RISTORATORE IN NUMBER,
	IN_COD_GESTORE_FP IN VARCHAR2,
	OUT_RET_CODE OUT NUMBER,
	OUT_RET_MESSAGE OUT VARCHAR2)
IS
	CHECK_COD_GESTORE_FP VARCHAR2(2);
	CHECK_COD_GESTORE_DAY VARCHAR2(2);
	CHECK_COD_DAY_RIST_GEST_DEMAT VARCHAR2(2);
	
BEGIN
	-- se IN_COD_GESTORE_FP = '05' ritorno esito 'OK'
	IF IN_COD_GESTORE_FP = '05' THEN
		OUT_RET_CODE := 0;
		OUT_RET_MESSAGE := 'OK';
	ELSE
		-- altrimenti cerco CODICE_GESTORE_DAY nella tabella di mapping/trascodifica WEBSVC_ADM.DAY_FP_CODICI_GESTORE
		SELECT CODICE_GESTORE_DAY
		INTO CHECK_COD_GESTORE_DAY
		FROM WEBSVC_ADM.DAY_FP_CODICI_GESTORE
		WHERE CODICE_GESTORE_FP = IN_COD_GESTORE_FP;
		
		-- se trovo un record valido alla data odierna nella tabella di mapping, allora
		-- verifico nella tabella WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT se esiste un record 
		-- valido con questo CODICE_GESTORE_DAY alla data odierna
		IF CHECK_COD_GESTORE_DAY IS NOT NULL THEN
			SELECT CODICE_GESTORE
			INTO CHECK_COD_DAY_RIST_GEST_DEMAT
			FROM WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT
			WHERE CODICE_GESTORE = CHECK_COD_GESTORE_DAY AND CODICE_RISTORATORE = IN_CODICE_RISTORATORE
			AND TRUNC(SYSDATE) BETWEEN DATA_INIZIO AND DATA_FINE;
		END IF;
			
		IF CHECK_COD_DAY_RIST_GEST_DEMAT IS NOT NULL AND CHECK_COD_DAY_RIST_GEST_DEMAT = '77' THEN
			SELECT CODICE_GESTORE
			INTO CHECK_COD_GESTORE_FP
			FROM WEBSVC_ADM.DAY_SOTTOGESTORI_DEMAT_NCR
			WHERE CODICE_GESTORE = IN_COD_GESTORE_FP;
			
			IF CHECK_COD_GESTORE_FP IN NOT NULL THEN
				OUT_RET_CODE := 0;
				OUT_RET_MESSAGE := 'OK';
			END IF;
			
		ELSE
			OUT_RET_CODE := 0;
			OUT_RET_MESSAGE := 'OK';
		END IF;
	
	END IF;

EXCEPTION WHEN OTHERS THEN
	OUT_RET_CODE := -1;
	OUT_RET_MESSAGE := 'KO';

END;
/

CREATE PUBLIC SYNONYM WEBSVC_PRC_CHECK_COD_GEST FOR WEBSVC_ADM.WEBSVC_PRC_CHECK_COD_GEST;

---------------------------------------------------

GRANT SELECT, INSERT, UPDATE, DELETE ON WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT TO IT_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WEBSVC_ADM.DAY_SOTTOGESTORI_DEMAT_NCR TO IT_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WEBSVC_ADM.DAY_FP_CODICI_GESTORE TO IT_ROLE;

---------------------------------------------------

INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('01', '01');
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('02', '02');
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('06', '06');
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('09', '26');
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('11', '11');
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('12', '12');
--INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('13',NULL);
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('14', '14');
--INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('15',NULL);
--INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('17',NULL);
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('26', '09');
INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('28', '77');
--INSERT INTO WEBSVC_ADM.DAY_FP_CODICI_GESTORE(CODICE_GESTORE_FP, CODICE_GESTORE_DAY) VALUES('33',NULL);


INSERT INTO WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT(ID_RECORD, CODICE_RISTORATORE, CODICE_GESTORE, DATA_INSERIMENTO, DATA_INIZIO, DATA_FINE)
VALUES (1, 100, '28', TRUNC(SYSDATE), TRUNC(SYSDATE), TO_DATE('31/12/2023', 'dd/mm/yyyy'));
INSERT INTO WEBSVC_ADM.DAY_RISTORATORI_GESTORI_DEMAT(ID_RECORD, CODICE_RISTORATORE, CODICE_GESTORE, DATA_INSERIMENTO, DATA_INIZIO, DATA_FINE)
VALUES (2, 20, '33', TRUNC(SYSDATE), TRUNC(SYSDATE), TO_DATE('31/12/2024', 'dd/mm/yyyy'));


INSERT INTO WEBSVC_ADM.DAY_SOTTOGESTORI_DEMAT_NCR(CODICE_GESTORE, DATA_INSERIMENTO) VALUES ('28', TRUNC(SYSDATE));

----------------------------------------------------

GRANT EXECUTE ON WEBSVC_ADM.WEBSVC_PRC_CHECK_COD_GEST TO IT_ROLE;

-- Test the Stored Procedure 'WEBSVC_ADM.WEBSVC_PRC_CHECK_COD_GEST' --
DECLARE 
  IN_CODICE_RISTORATORE NUMBER;
  IN_COD_GESTORE_FP VARCHAR2(32767);
  OUT_RET_CODE NUMBER;
  OUT_RET_MESSAGE VARCHAR2(32767);

BEGIN 
  IN_CODICE_RISTORATORE := 139181;
  IN_COD_GESTORE_FP := '28';
  OUT_RET_CODE := NULL;
  OUT_RET_MESSAGE := NULL;

  WEBSVC_ADM.WEBSVC_PRC_CHECK_COD_GEST ( IN_CODICE_RISTORATORE, IN_COD_GESTORE_FP, OUT_RET_CODE, OUT_RET_MESSAGE );

  DBMS_OUTPUT.Put_Line('OUT_RET_CODE = ' || TO_CHAR(OUT_RET_CODE));
  DBMS_OUTPUT.Put_Line('OUT_RET_MESSAGE = ' || OUT_RET_MESSAGE);

  DBMS_OUTPUT.Put_Line('');

  COMMIT; 
END;

-------------------------------------------------

GRANT EXECUTE ON WEBSVC_ADM.WEBSVC_FCT_COD_GEST_CALLER TO IT_ROLE;

-- Test the Function 'WEBSVC_ADM.WEBSVC_FCT_COD_GEST_CALLER' --
DECLARE
  CODE_GEST VARCHAR2(32767);
  IN_CODICE_SERVIZIO VARCHAR2(32767);
  IN_INDIRIZZO_IP_CHIAMANTE VARCHAR2(32767);

BEGIN
  IN_CODICE_SERVIZIO := 'WEBSVC003';
  IN_INDIRIZZO_IP_CHIAMANTE := '10.0.2.138';

  CODE_GEST := WEBSVC_ADM.WEBSVC_FCT_COD_GEST_CALLER(IN_CODICE_SERVIZIO, IN_INDIRIZZO_IP_CHIAMANTE);
  
  DBMS_OUTPUT.Put_Line('CODE_GEST = ' || TO_CHAR(CODE_GEST));
  DBMS_OUTPUT.Put_Line('');
  
  COMMIT;
END;
/

-------------------------------------------------

CREATE TABLE POS_UNICO.UTENTE (
    ID_UTENTE NUMBER(6) NOT NULL,
    NOME VARCHAR2(200) NOT NULL,
    COGNOME VARCHAR2(200) NOT NULL,
    INDIRIZZO VARCHAR2(255) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL,
    USERNAME VARCHAR2(50) NOT NULL,
    PASSWD VARCHAR2(255) NOT NULL,
    ABILITATO NUMBER(1)
);

ALTER TABLE POS_UNICO.UTENTE ADD CONSTRAINT UTENTE_PK PRIMARY KEY(ID_UTENTE);

ALTER TABLE POS_UNICO.UTENTE ADD UNIQUE (USERNAME) ENABLE VALIDATE;

CREATE OR REPLACE PUBLIC SYNONYM UTENTE FOR POS_UNICO.UTENTE;

----------------

CREATE TABLE POS_UNICO.RUOLO (
    ID_RUOLO NUMBER(6) NOT NULL,
    NOME VARCHAR2(50) NOT NULL
);

ALTER TABLE POS_UNICO.RUOLO ADD CONSTRAINT RUOLO_PK PRIMARY KEY(ID_RUOLO);

ALTER TABLE POS_UNICO.RUOLO ADD UNIQUE (NOME) ENABLE VALIDATE;

CREATE OR REPLACE PUBLIC SYNONYM RUOLO FOR POS_UNICO.RUOLO;

----------------

CREATE TABLE POS_UNICO.UTENTE_RUOLO (
    ID_UTENTE NUMBER(6) NOT NULL,
    ID_RUOLO NUMBER(6) NOT NULL
);

CREATE OR REPLACE PUBLIC SYNONYM UTENTE_RUOLO FOR POS_UNICO.UTENTE_RUOLO;


CREATE TABLE POS_UNICO.JWT_SECRET (
  JWT_ID          NUMBER(6) NOT NULL,
  JWT_SECRET_KEY  VARCHAR2(500 BYTE) NOT NULL
);

ALTER TABLE POS_UNICO.JWT_SECRET ADD CONSTRAINT JWT_SECRET_PK PRIMARY KEY (JWT_ID);

CREATE OR REPLACE PUBLIC SYNONYM JWT_SECRET FOR BIRD.JWT_SECRET;

GRANT SELECT, INSERT, UPDATE, DELETE ON POS_UNICO.JWT_SECRET TO IT_ROLE;

INSERT INTO POS_UNICO.JWT_SECRET VALUES (1, 't0uih!m=y6^vi#fmz028a4h0m+534e7ed86a97aa59f627fe6b3%%5drAg%t0ciy@3#tf2!khq46');


------------------------------------------------------------------------------

CREATE TABLE PUBLIC.UTENTE_RUOLO (
	ID_UTENTE BIGINT NOT NULL,
	ID_RUOLO BIGINT NOT NULL,
	CONSTRAINT UTENTE_RUOLO_FK FOREIGN KEY (ID_UTENTE) REFERENCES PUBLIC.UTENTE(ID_UTENTE),
	CONSTRAINT UTENTE_RUOLO_FK_1 FOREIGN KEY (ID_RUOLO) REFERENCES PUBLIC.RUOLO(ID_RUOLO)
);

CREATE TABLE PUBLIC.UTENTE (
	ID_UTENTE BIGINT NOT NULL AUTO_INCREMENT,
	USERNAME CHARACTER VARYING(200) NOT NULL,
	PASSWORD CHARACTER VARYING(255) NOT NULL,
	NOME CHARACTER VARYING(100),
	COGNOME CHARACTER VARYING(150),
	EMAIL CHARACTER VARYING(50) NOT NULL,
	INDIRIZZO CHARACTER VARYING(255),
	CONSTRAINT UTENTE_PK PRIMARY KEY (ID_UTENTE)
);

CREATE TABLE PUBLIC.RUOLO (
	ID_RUOLO BIGINT NOT NULL AUTO_INCREMENT,
	NOME CHARACTER VARYING(30) NOT NULL,
	CONSTRAINT RUOLO_PK PRIMARY KEY (ID_RUOLO)
);


------------------------------------------------


CREATE TABLE BIRD.POS_UNICO_CARICAMENTI (
  ID_CARICAMENTO            NUMBER NOT NULL,
  RIGA                      NUMBER NOT NULL,
  ESITO                     VARCHAR2(100 BYTE),
  PIVA                      VARCHAR2(100 BYTE),
  RAGIONE_SOCIALE           VARCHAR2(100 BYTE),
  INDIRIZZO_SEDE_LEGALE     VARCHAR2(100 BYTE),
  CIVICO_SL                 VARCHAR2(100 BYTE),
  CAP_SL                    VARCHAR2(100 BYTE),
  COMUNE_SL                 VARCHAR2(100 BYTE),
  PROV_SL                   VARCHAR2(100 BYTE),
  COD_SDI                   VARCHAR2(100 BYTE),
  CELL                      VARCHAR2(100 BYTE),
  TELEFONO                  VARCHAR2(100 BYTE),
  MAIL                      VARCHAR2(100 BYTE),
  PEC                       VARCHAR2(100 BYTE),
  INSEGNA                   VARCHAR2(100 BYTE),
  INDIRIZZO_PV              VARCHAR2(100 BYTE),
  CIVICO_PV                 VARCHAR2(15 BYTE),
  CAP_PV                    VARCHAR2(100 BYTE),
  COMUNE_PV                 VARCHAR2(100 BYTE),
  PROV_PV                   VARCHAR2(100 BYTE),
  COSTO_ATTIVAZIONE         VARCHAR2(100 BYTE),
  CANONE_MENSILE            VARCHAR2(100 BYTE),
  COSTO_PER_BUONO_TRANSATO  VARCHAR2(100 BYTE),
  CAUZIONE                  VARCHAR2(100 BYTE),
  IBAN_CC                   VARCHAR2(100 BYTE),
  CF_SOTTOSCRITTORE         VARCHAR2(100 BYTE),
  NOME_COGNOME              VARCHAR2(100 BYTE),
  LUOGO_NASCITA             VARCHAR2(100 BYTE),
  DATA_NASCITA              VARCHAR2(100 BYTE),
  DATA_SOTTOSCRIZIONE       VARCHAR2(100 BYTE),
  REVISIONE                 VARCHAR2(100 BYTE),
  EMETTITORE_PELLEGRINI     VARCHAR2(100 BYTE),
  EMETTITORE_DAY            VARCHAR2(100 BYTE),
  EMETTITORE_SDX            VARCHAR2(100 BYTE),
  N_POS_RICHIESTI           VARCHAR2(100 BYTE),
  NOME_FILE                 VARCHAR2(100 BYTE),
  FLAG_ELABORATO            VARCHAR2(1 CHAR) DEFAULT 'N' NOT NULL,
  NOME_UTENTE               VARCHAR2(100 BYTE),
  NOME_PROCEDURA            VARCHAR2(100 BYTE),
  ESITO_ELABORAZIONE        VARCHAR2(3 BYTE),
  ERROR_MESSAGE             VARCHAR2(4000 BYTE)
);

ALTER TABLE BIRD.POS_UNICO_CARICAMENTI ADD (ESITO_ELABORAZIONE VARCHAR2(3 BYTE));
ALTER TABLE BIRD.POS_UNICO_CARICAMENTI ADD (ERROR_MESSAGE VARCHAR2(4000 BYTE));

ALTER TABLE BIRD.POS_UNICO_CARICAMENTI ADD CONSTRAINT POS_UNICO_CARICAMENTI_PK PRIMARY KEY (ID_CARICAMENTO);

GRANT SELECT, INSERT, UPDATE, DELETE ON BIRD.POS_UNICO_CARICAMENTI TO IT_ROLE;

ALTER TABLE BIRD.POS_UNICO_CARICAMENTI ADD (ESITO_ELABORAZIONE VARCHAR2(3 BYTE));
ALTER TABLE BIRD.POS_UNICO_CARICAMENTI ADD (ERROR_MESSAGE VARCHAR2(4000 BYTE));


------------------------------------------------------------------------


CREATE OR REPLACE PACKAGE BIRD.PKG_POS_UNICO_CARICAMENTI AS

    /*TYPE caricamento_input_rec IS RECORD(
		ID_CARICAMENTO_REC           NUMBER NOT NULL,
		ESITO                     	 VARCHAR2(100 BYTE),
		PIVA_REC                     VARCHAR2(100 BYTE),
		RAGIONE_SOCIALE_REC          VARCHAR2(100 BYTE),
		INDIRIZZO_SEDE_LEGALE_REC    VARCHAR2(100 BYTE),
		CIVICO_SL_REC                VARCHAR2(100 BYTE),
		CAP_SL_REC                   VARCHAR2(100 BYTE),
		COMUNE_SL_REC                VARCHAR2(100 BYTE),
		PROV_SL_REC                  VARCHAR2(100 BYTE),
		COD_SDI_REC                  VARCHAR2(100 BYTE),
		CELL_REC                     VARCHAR2(100 BYTE),
		TELEFONO_REC                 VARCHAR2(100 BYTE),
		MAIL_REC                     VARCHAR2(100 BYTE),
		PEC_REC                      VARCHAR2(100 BYTE),
		INSEGNA_REC                  VARCHAR2(100 BYTE),
		INDIRIZZO_PV_REC             VARCHAR2(100 BYTE),
		CIVICO_PV_REC                VARCHAR2(100 BYTE),
		CAP_PV_REC                   VARCHAR2(100 BYTE),
		COMUNE_PV_REC                VARCHAR2(100 BYTE),
		PROV_PV_REC                  VARCHAR2(100 BYTE),
		COSTO_ATTIVAZIONE_REC        VARCHAR2(100 BYTE),
		CANONE_MENSILE_REC        	 VARCHAR2(100 BYTE),
		COSTO_PER_BUONO_TRANSATO_REC VARCHAR2(100 BYTE),
		CAUZIONE_REC                 VARCHAR2(100 BYTE),
		IBAN_CC_REC                  VARCHAR2(100 BYTE),
		CF_SOTTOSCRITTORE_REC        VARCHAR2(100 BYTE),
		NOME_COGNOME_REC             VARCHAR2(100 BYTE),
		LUOGO_NASCITA_REC            VARCHAR2(100 BYTE),
		DATA_NASCITA_REC             VARCHAR2(100 BYTE),
		DATA_SOTTOSCRIZIONE_REC      VARCHAR2(100 BYTE),
		REVISIONE_REC				 VARCHAR2(100 BYTE),
		EMETTITORE_PELLEGRINI_REC    VARCHAR2(100 BYTE),
		EMETTITORE_DAY_REC           VARCHAR2(100 BYTE),
		EMETTITORE_SDX_REC           VARCHAR2(100 BYTE),
		N_POS_RICHIESTI_REC          VARCHAR2(100 BYTE),
		NOME_FILE_REC                VARCHAR2(100 BYTE),
		NOME_UTENTE_REC 			 VARCHAR2(100 BYTE),
		FLAG_ELABORATO_REC           VARCHAR2(1 CHAR)
	);*/
	
	--TYPE caricamento_table IS TABLE OF caricamento_input_rec INDEX BY BINARY_INTEGER;
    PROCEDURE POPOLA_POS_UNICO_CARICAMENTI;
	PROCEDURE POPOLA_POS_UNICO_AFFILIATI(P_ROW_CARICAMENTI IN BIRD.POS_UNICO_CARICAMENTI%ROWTYPE, P_PIVA IN VARCHAR2);
	PROCEDURE POPOLA_RISTORATORI(P_ROW_CARICAMENTI IN BIRD.POS_UNICO_CARICAMENTI%ROWTYPE);
	PROCEDURE POPOLA_POS_UNICO_CONTRATTI();
	PROCEDURE POPOLA_POS_UNICO_CONTRATTI_SERVIZI();
	PROCEDURE POPOLA_POS_UNICO_CONTRATTI_PV();
	PROCEDURE POPOLA_POS_UNICO_ANAGRAFICA_IBAN();
	PROCEDURE POPOLA_POS_UNICO_IBAN_CONTRATTI();
	PROCEDURE POPOLA_POS_UNICO_RICHIESTA_CODIFICHE();

END PKG_POS_UNICO_CARICAMENTI;
/

------------------------------------------------------


PPOPOLA_POS_UNICO_AFFILIATI(C, C.PIVA);
POPOLA_RISTORATORI(C);
POPOLA_POS_UNICO_CONTRATTI(C, V_RIS_CODICE, V_RIS_FILIALE);
POPOLA_POS_UNICO_CONTRATTI_SERVIZI(C, V_TBC_CONTRATTO_KEY);
POPOLA_POS_UNICO_CONTRATTI_PV(V_SOC_CODICE, V_RIS_CODICE, V_RIS_FILIALE, V_TBC_CONTRATTO_KEY);
POPOLA_POS_UNICO_ANAGRAFICA_IBAN(C, V_SOC_CODICE);
POPOLA_POS_UNICO_IBAN_CONTRATTI(V_SOC_CODICE, V_AIB_ID, V_RIS_CODICE, V_RIS_FILIALE, V_TBC_CONTRATTO_KEY);
POPOLA_POS_UNICO_RICHIESTA_CODIFICHE(C, V_SOC_CODICE, V_RIS_CODICE, V_RIS_FILIALE, V_TBC_CONTRATTO_KEY);


DECLARE 
	P_ROW_CARICAMENTI BIRD.POS_UNICO_CARICAMENTI%rowtype;

BEGIN
	SELECT * INTO P_ROW_CARICAMENTI FROM BIRD.POS_UNICO_CARICAMENTI;

	BIRD.PKG_POS_UNICO_CARICAMENTI.POPOLA_RISTORATORI(P_ROW_CARICAMENTI);
	COMMIT; 
END;


DECLARE 
  P_ROW_CARICAMENTI BIRD.POS_UNICO_CARICAMENTI%rowtype;
  P_PIVA VARCHAR2(32767);

BEGIN
  SELECT * INTO P_ROW_CARICAMENTI FROM BIRD.POS_UNICO_CARICAMENTI;
  P_PIVA := '10337360018';

  BIRD.PKG_POS_UNICO_CARICAMENTI.POPOLA_POS_UNICO_AFFILIATI ( P_ROW_CARICAMENTI, P_PIVA );
  COMMIT; 
END;


-- #####################################################################


V_RIS_CODICE = 10157

V_RIS_FILIALE = 1

V_NUM_LOCALI = 0

V_TBC_CONTRATTO_KEY = 'CTR3'

V_AIB_ID = 1


PKG_NAME CONSTANT VARCHAR2(50) := 'BIRD.PKG_POS_UNICO_CARICAMENTI'

-- ######################################################################


DECLARE 
  USER_ID VARCHAR2(32767);
  TIPO_TRACCIATO VARCHAR2(32767);
  JSON_APILOB CLOB;
  PROGRESSIVO_JSON NUMBER;
  CODE_ERRORE NUMBER;
  ERROR_MESSAGE VARCHAR2(32767);

BEGIN 
  USER_ID := 'pippo';
  TIPO_TRACCIATO := NULL;
  -- ---------------------
  -- CREATE TEMPORARY CLOB
  -- ---------------------
  DBMS_LOB.CREATETEMPORARY(JSON_APILOB, true);  -- NOTE: This only initialized the CLOB.  A value still needs to be assigned.
    -- ie DBMS_LOB.OPEN(JSON_APILOB, DBMS_LOB.LOB_READWRITE);
  PROGRESSIVO_JSON := NULL;
  CODE_ERRORE := NULL;
  ERROR_MESSAGE := NULL;

  POS_UNICO.PKG_POSUNICO_LOG.PROC_INSERISCI_JSONAPI ( USER_ID, TIPO_TRACCIATO, JSON_APILOB, PROGRESSIVO_JSON, CODE_ERRORE, ERROR_MESSAGE );
  COMMIT; 
END;


-- ####################################################################

ALTER TABLE POS_UNICO.ANAGRAFICA_ACCOUNT DROP COLUMN ACC_COD_SDI;

ALTER TABLE POS_UNICO.CONTRATTI_POS_RICHIESTI MODIFY(CPR_ID_CONTRATTO NUMBER);



-- ####################################################################

ALTER TABLE POS_UNICO.ANAGRAFICA_ACCOUNT ADD (VERSION  NUMBER);



CREATE SEQUENCE POS_UNICO.SEQ_UTENTE
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_UTENTE FOR POS_UNICO.SEQ_UTENTE;

GRANT SELECT, DROP ON POS_UNICO.SEQ_UTENTE TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_RUOLO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_RUOLO FOR POS_UNICO.SEQ_RUOLO;


GRANT SELECT, DROP ON POS_UNICO.SEQ_RUOLO TO IT_ROLE;


---------------------------



CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAACCOUNTAFFILIATO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAACCOUNTAFFILIATO FOR POS_UNICO.SEQ_ANAGRAFICAACCOUNTAFFILIATO;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAACCOUNTAFFILIATO TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAEMETTITORE
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAEMETTITORE FOR POS_UNICO.SEQ_ANAGRAFICAEMETTITORE;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAEMETTITORE TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAIBAN
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAIBAN FOR POS_UNICO.SEQ_ANAGRAFICAIBAN;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAIBAN TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAPUNTOVENDITA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAPUNTOVENDITA FOR POS_UNICO.SEQ_ANAGRAFICAPUNTOVENDITA;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAPUNTOVENDITA TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICASERVIZIO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICASERVIZIO FOR POS_UNICO.SEQ_ANAGRAFICASERVIZIO;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICASERVIZIO TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_CONTRATTI
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_CONTRATTI FOR POS_UNICO.SEQ_CONTRATTI;


GRANT SELECT ON POS_UNICO.SEQ_CONTRATTI TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_CONTRATTOEMETTITOREDICHIARATO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_CONTRATTOEMETTITOREDICHIARATO FOR POS_UNICO.SEQ_CONTRATTOEMETTITOREDICHIARATO;


GRANT SELECT ON POS_UNICO.SEQ_CONTRATTOEMETTITOREDICHIARATO TO IT_ROLE;


---------------------------



CREATE SEQUENCE POS_UNICO.SEQ_CONTRATTOSERVIZIO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_CONTRATTOSERVIZIO FOR POS_UNICO.SEQ_CONTRATTOSERVIZIO;


GRANT SELECT ON POS_UNICO.SEQ_CONTRATTOSERVIZIO TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_PVELENCOEMETTITORI
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_PVELENCOEMETTITORI FOR POS_UNICO.SEQ_PVELENCOEMETTITORI;


GRANT SELECT ON POS_UNICO.SEQ_PVELENCOEMETTITORI TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_SERVIZIOPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_SERVIZIOPOS FOR POS_UNICO.SEQ_SERVIZIOPOS;


GRANT SELECT ON POS_UNICO.SEQ_SERVIZIOPOS TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_CONTRATTIPOSRICHIESTO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_CONTRATTIPOSRICHIESTO FOR POS_UNICO.SEQ_CONTRATTIPOSRICHIESTO;


GRANT SELECT ON POS_UNICO.SEQ_CONTRATTIPOSRICHIESTO TO IT_ROLE;


-- 26-09-2023 --------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_DATITECNICIPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_DATITECNICIPOS FOR POS_UNICO.SEQ_DATITECNICIPOS;


GRANT SELECT ON POS_UNICO.SEQ_DATITECNICIPOS TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_TIPOLOGIAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_TIPOLOGIAPOS FOR POS_UNICO.SEQ_TIPOLOGIAPOS;


GRANT SELECT ON POS_UNICO.SEQ_TIPOLOGIAPOS TO IT_ROLE;



--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ACCESSORIPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ACCESSORIPOS FOR POS_UNICO.SEQ_ACCESSORIPOS;


GRANT SELECT ON POS_UNICO.SEQ_ACCESSORIPOS TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_CONNETTIVITAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_CONNETTIVITAPOS FOR POS_UNICO.SEQ_CONNETTIVITAPOS;


GRANT SELECT ON POS_UNICO.SEQ_CONNETTIVITAPOS TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICATIPOLOGIAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICATIPOLOGIAPOS FOR POS_UNICO.SEQ_ANAGRAFICATIPOLOGIAPOS;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICATIPOLOGIAPOS TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICACONNETTIVITAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICACONNETTIVITAPOS FOR POS_UNICO.SEQ_ANAGRAFICACONNETTIVITAPOS;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICACONNETTIVITAPOS TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAACCESSORIPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAACCESSORIPOS FOR POS_UNICO.SEQ_ANAGRAFICAACCESSORIPOS;


GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAACCESSORIPOS TO IT_ROLE;


---------------------------

CREATE SEQUENCE POS_UNICO.SEQ_EMETTITORE_TIPO_CODIFICA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_EMETTITORE_TIPO_CODIFICA FOR POS_UNICO.SEQ_EMETTITORE_TIPO_CODIFICA;


GRANT SELECT ON POS_UNICO.SEQ_EMETTITORE_TIPO_CODIFICA TO IT_ROLE;


---------------------------

CREATE SEQUENCE POS_UNICO.SEQ_DETTANOMALIALAVORAZIONEPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_DETTANOMALIALAVORAZIONEPOS FOR POS_UNICO.SEQ_DETTANOMALIALAVORAZIONEPOS;


GRANT SELECT ON POS_UNICO.SEQ_DETTANOMALIALAVORAZIONEPOS TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_TERMINALIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_TERMINALIUNICAPOS FOR POS_UNICO.SEQ_TERMINALIUNICAPOS;


GRANT SELECT ON POS_UNICO.SEQ_TERMINALIUNICAPOS TO IT_ROLE;


----------------------------


CREATE SEQUENCE POS_UNICO.SEQ_SIMTERMINALIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_SIMTERMINALIUNICAPOS FOR POS_UNICO.SEQ_SIMTERMINALIUNICAPOS;


GRANT SELECT ON POS_UNICO.SEQ_SIMTERMINALIUNICAPOS TO IT_ROLE;


----------------------------



CREATE SEQUENCE POS_UNICO.SEQ_BARCODEREADERUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_BARCODEREADERUNICAPOS FOR POS_UNICO.SEQ_BARCODEREADERUNICAPOS;


GRANT SELECT ON POS_UNICO.SEQ_BARCODEREADERUNICAPOS TO IT_ROLE;




-- ####################################################################


ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI DROP PRIMARY KEY CASCADE;


DROP TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI CASCADE CONSTRAINTS;


CREATE TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI
(
  CED_SOC_CODICE     NUMBER,
  CED_CONTRATTO_KEY  NUMBER,
  CED_ID_EMETTITORE  NUMBER,
  CED_DTINS          DATE,
  CED_USERINS        VARCHAR2(20 BYTE),
  CED_DTAGG          DATE,
  CED_USERAGG        VARCHAR2(20 BYTE),
  VERSION            NUMBER
);

ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI ADD CONSTRAINT CONTRATTI_EMETTITORI_DICHIARATI_PK PRIMARY KEY(CED_SOC_CODICE, CED_ID_EMETTITORE);


CREATE OR REPLACE PUBLIC SYNONYM CONTRATTI_EMETTITORI_DICHIARATI FOR POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI;


GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI TO IT_ROLE;

------------------------------------------------


ALTER TABLE POS_UNICO.CONTRATTI_SERVIZI DROP PRIMARY KEY CASCADE;

DROP TABLE POS_UNICO.CONTRATTI_SERVIZI CASCADE CONSTRAINTS;

CREATE TABLE POS_UNICO.CONTRATTI_SERVIZI
(
  CS_SOC_CODICE            NUMBER,
  CS_ID_SERVIZIO           VARCHAR2(10 BYTE),
  CS_CONTRATTO_KEY         NUMBER,
  CS_SERVIZIO_KEY          NUMBER,
  CS_VALORE_PERC           NUMBER,
  CS_VALORE_UNITARIO       NUMBER,
  CS_STATO                 VARCHAR2(1 BYTE),
  CS_DATA_INIZIO_VALIDITA  DATE,
  CS_DATA_FINE_VALIDITA    DATE,
  CS_DTINS                 DATE,
  CS_USER_INS              VARCHAR2(50 BYTE),
  CS_DTAGG                 DATE,
  CS_USER_AGG              VARCHAR2(50 BYTE),
  VERSION                  NUMBER
)

ALTER TABLE POS_UNICO.CONTRATTI_SERVIZI ADD ( CONSTRAINT CONTRATTI_SERVIZI_PK PRIMARY KEY (CS_SOC_CODICE, CS_SERVIZIO_KEY, CS_ID_SERVIZIO);

CREATE OR REPLACE PUBLIC SYNONYM CONTRATTI_SERVIZI FOR POS_UNICO.CONTRATTI_SERVIZI;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.CONTRATTI_SERVIZI TO IT_ROLE;


-------------------------------------------------------------------------------------


ALTER TABLE POS_UNICO.ANAGRAFICA_PUNTI_VENDITA MODIFY(APV_ACCOUNT_KEY NULL);

-------------------------------------------------------------------------------------

ALTER TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI DROP PRIMARY KEY CASCADE;

DROP TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI CASCADE CONSTRAINTS;

CREATE TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI
(
  PVC_PUNTO_VENDITA_KEY  NUMBER                 NOT NULL,
  PVC_CONTRATTO_KEY      NUMBER                 NOT NULL,
  PVC_DTINS              DATE,
  PVC_USER_INS           VARCHAR2(50 BYTE),
  PVC_DTAGG              DATE,
  PVC_USER_AGG           VARCHAR2(50 BYTE)
);

CREATE OR REPLACE PUBLIC SYNONYM PUNTI_VENDITA_CONTRATTI FOR POS_UNICO.PUNTI_VENDITA_CONTRATTI;


ALTER TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI ADD CONSTRAINT PUNTI_VENDITA_CONTRATTI_PK PRIMARY KEY (PVC_PUNTO_VENDITA_KEY, PVC_CONTRATTO_KEY);

ALTER TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI ADD ( CONSTRAINT PUNTI_VENDITA_CONTRATTI_FK FOREIGN KEY (PVC_PUNTO_VENDITA_KEY) REFERENCES POS_UNICO.ANAGRAFICA_PUNTI_VENDITA(APV_PUNTO_VENDITA_KEY));

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.PUNTI_VENDITA_CONTRATTI TO IT_ROLE;

----------------------------------------------

ALTER TABLE POS_UNICO.CONTRATTI_POS_RICHIESTI RENAME COLUMN CPR_CONTRACT_KEY TO CPR_CONTRATTO_KEY;

ALTER TABLE POS_UNICO.PV_ELENCO_EMETTITORI RENAME COLUMN EPV_ID_EMETTITORE TO EPV_EMETTITORE_KEY;

ALTER TABLE POS_UNICO.ANAGRAFICA_EMETTITORI ADD (AE_EMETTITORE_KEY NUMBER);

ALTER TABLE POS_UNICO.ANAGRAFICA_EMETTITORI MODIFY(AE_ID_EMETTITORE VARCHAR2(10));

----------------------------------------------

--      (CONTRATTI --> PUNTI_VENDITA_CONTRATTI <-- ANAGRAFICA_PUNTI_VENDITA)

--      (CONTRATTI --> CONTRATTI_POS_RICHIESTI <-- ANAGRAFICA_PUNTI_VENDITA)


ALTER TABLE POS_UNICO.PV_ELENCO_EMETTITORI DROP CONSTRAINT FK1_PV_ELENCO_EMETTITORI CASCADE;

ALTER TABLE POS_UNICO.PV_ELENCO_EMETTITORI ADD (CONSTRAINT FK1_PV_ELENCO_EMETTITORI FOREIGN KEY (EPV_PUNTO_VENDITA_KEY) REFERENCES POS_UNICO.ANAGRAFICA_PUNTI_VENDITA (APV_PUNTO_VENDITA_KEY ) ENABLE VALIDATE);
ALTER TABLE POS_UNICO.PV_ELENCO_EMETTITORI ADD (CONSTRAINT FK2_PV_ELENCO_EMETTITORI FOREIGN KEY (EPV_EMETTITORE_KEY) REFERENCES POS_UNICO.ANAGRAFICA_EMETTITORI (AE_EMETTITORE_KEY) ENABLE VALIDATE);

----------------------------------------------------------------------------------------

ALTER TABLE POS_UNICO.ANAGRAFICA_EMETTITORI DROP PRIMARY KEY CASCADE;

DROP TABLE POS_UNICO.ANAGRAFICA_EMETTITORI CASCADE CONSTRAINTS;

CREATE TABLE POS_UNICO.ANAGRAFICA_EMETTITORI
(
  AE_EMETTITORE_KEY  NUMBER,
  AE_ID_EMETTITORE   VARCHAR2(10 BYTE),
  AE_SOC_CODICE      NUMBER,
  AE_COD_EMETTITORE  VARCHAR2(100 BYTE),
  AE_DESCRIZIONE     VARCHAR2(1000 BYTE),
  AE_STATO           VARCHAR2(3 BYTE),
  AE_DTINS           DATE,
  AE_DTAGG           DATE,
  VERSION            NUMBER
);

ALTER TABLE POS_UNICO.ANAGRAFICA_EMETTITORI ADD CONSTRAINT ANAGRAFICA_EMETTITORI_PK PRIMARY KEY (AE_SOC_CODICE, AE_EMETTITORE_KEY);

CREATE OR REPLACE PUBLIC SYNONYM ANAGRAFICA_EMETTITORI FOR POS_UNICO.ANAGRAFICA_EMETTITORI;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.ANAGRAFICA_EMETTITORI TO IT_ROLE;


--------------------------------------------------------------------------------------------------

ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI DROP PRIMARY KEY CASCADE;

DROP TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI CASCADE CONSTRAINTS;

CREATE TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI
(
  CED_SOC_CODICE      NUMBER,
  CED_CONTRATTO_KEY   NUMBER,
  CED_EMETTITORE_KEY  NUMBER,
  CED_ID_CONTRATTO    VARCHAR2(10 BYTE),
  CED_ID_EMETTITORE   VARCHAR2(10 BYTE),
  CED_DTINS           DATE,
  CED_USERINS         VARCHAR2(20 BYTE),
  CED_DTAGG           DATE,
  CED_USERAGG         VARCHAR2(20 BYTE)
);

CREATE OR REPLACE PUBLIC SYNONYM CONTRATTI_EMETTITORI_DICHIARATI FOR POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI TO IT_ROLE;

ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI ADD CONSTRAINT CONTRATTI_EMETTITORI_DICHIARATI_PK PRIMARY KEY (CED_EMETTITORE_KEY);


ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI ADD (CONSTRAINT FK1_CONTRATTI_EMETTITORI_DICHIARATI FOREIGN KEY (CED_CONTRATTO_KEY) REFERENCES POS_UNICO.CONTRATTI (CTR_CONTRATTO_KEY) ENABLE VALIDATE);

ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI ADD (CONSTRAINT FK2_CONTRATTI_EMETTITORI_DICHIARATI FOREIGN KEY (CED_EMETTITORE_KEY) REFERENCES POS_UNICO.ANAGRAFICA_EMETTITORI (AE_EMETTITORE_KEY) ENABLE VALIDATE);


-----------------------------------------------------------------------------------


ALTER TABLE POS_UNICO.ANAGRAFICA_IBAN RENAME COLUMN AIB_ID_CONTRATTO TO AIB_CONTRATTO_KEY;


-----------------------------------------------------------------------------------

ALTER TABLE POS_UNICO.CONTRATTI_RINEGOZIATI RENAME COLUMN CR_CONTRATTO_KEY_RINEGO TO CR_CONTRATTO_KEY_RINEGOZIATO;

-----------------------------------------------------------------------------------

ALTER TABLE POS_UNICO.CONTRATTI DROP CONSTRAINT FK2_CONTRATTI;
ALTER TABLE POS_UNICO.CONTRATTI DROP COLUMN CTR_IBAN_KEY;

-----------------------------------------------------------------------------------


ALTER TABLE POS_UNICO.MAGAZZINO_MOVIMENTI_DETTAGLIO ADD CONSTRAINT MAGAZZINO_DETTAG_TERMINALI_FK FOREIGN KEY (MMD_SERIALE) REFERENCES POS_UNICO.TERMINALI_UNICA_POS(TU_SERIALE_POS);



INSERT INTO POS_UNICO.ANAGRAFICA_EMETTITORI (
   AE_EMETTITORE_KEY,
   AE_ID_EMETTITORE,
   AE_SOC_CODICE, 
   AE_COD_EMETTITORE,
   AE_DESCRIZIONE,
   AE_STATO, 
   AE_DTINS,
   AE_DTAGG,
   VERSION) 
VALUES ( 
   POS_UNICO.SEQ_ANAGRAFICAEMETTITORE.nextval,
   '1',
   88,
   '06',
   'Test Descrizione',
   'A',
   SYSDATE,
   SYSDATE,
   0);
   
   COMMIT;
   
---------------------------------------------------

INSERT INTO POS_UNICO.ANAGRAFICA_SERVIZI (
   AS_SOC_CODICE,
   AS_SERVIZIO_KEY,
   AS_ID_SERVIZIO, 
   AS_DESCR_SERVIZIO,
   AS_FLAG_IMPORTO_UNITARIO,
   AS_FLAG_IMPORTO_PERC, 
   AS_DT_INIZ_VALIDITA,
   AS_DTINS, 
   AS_USER_INS,
   AS_DTAGG,
   AS_USER_AGG, 
   VERSION) 
VALUES ( 
  88,
  POS_UNICO.SEQ_ANAGRAFICASERVIZIO.nextval,
  '5',
  'Test Descrizione',
  '2',
  '3',
  SYSDATE,
  SYSDATE,
  'TODO',
  SYSDATE,
  'TODO',
  0);
   
   
COMMIT;

------------------------------------

--	List<Contratto> contratti = contrattoRepository.findAll(ContrattoQuerySpecification.findContrattoByContrattoKeyJoinFetchAll(id));
--
--	if (!contratti.isEmpty()) {
--		return ResponseEntity.ok().body(CustomContrattoMapper.contratoListToContrattoDtoList(contratti));
--	}

------------------------------------

-- @Transactional(propagation=Propagation.REQUIRED, readOnly=true, noRollbackFor=Exception.class)

-- The artifact org.hibernate:hibernate-jpamodelgen:jar:6.1.7.Final has been relocated to org.hibernate.orm:hibernate-jpamodelgen:jar:6.1.7.Final

org.hibernate.LazyInitializationException: could not initialize proxy [it.fastpoint.amedea.api.model.Ruolo#4] - no Session


password 'lara' => '$2a$10$gIUdx5pBIataEhVkPG.pV.8bV4/CJgOEOv3sXKEXP2nzoAu/rL53a'

-- ################################################################################################

{
    "id": null,
    "username": "Utente9",
    "password": "utente9",
    "nome": "Test nome Utente9",
    "cognome": "Test cognome Utente9",
    "email": "utente9@test.it",
    "indirizzo": "Parco Sud",
    "ruoli": [
        {
            "id": 3,
            "nome": "ROLE_ADMIN"
        },
        {
            "id": null,
            "nome": "RUOLO_PROVA_3"
        },
        {
            "id": null,
            "nome": "ROLE_EDITOR"
        },
        {
            "id": 4,
            "nome": "ROLE_USER"
        },
        {
            "id": null,
            "nome": "RUOLO_PROVA_4"
        }
    ]
}

-- ################################################################################################

[
    {
        "id": 19,
        "username": "utente",
        "nome": "Test nome Utente",
        "cognome": "Test cognome Utente",
        "email": "utente@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": [
            {
                "id": 4,
                "nome": "ROLE_USER"
            }
        ]
    },
    {
        "id": 16,
        "username": "papera", 
        "nome": "Papera",
        "cognome": "Papera",
        "email": "papera@test.it",
        "indirizzo": "Viale Roma 20",
        "ruoli": []
    },
    {
        "id": 5,
        "username": "lara",
        "nome": "Lara",
        "cognome": "Simpson",
        "email": "lara@email.com",
        "indirizzo": "Via Milano 1",
        "ruoli": [
            {
                "id": 3,
                "nome": "ROLE_ADMIN"
            }
        ]
    },
    {
        "id": 7,
        "username": "brandon",
        "nome": "Brandon",
        "cognome": "Lee",
        "email": "brandon@aol.com",
        "indirizzo": "Via Garibaldi 2",
        "ruoli": [
            {
                "id": 4,
                "nome": "ROLE_USER"
            },
            {
                "id": 3,
                "nome": "ROLE_ADMIN"
            }
        ]
    },
    {
        "id": 6,
        "username": "wilma",
        "nome": "Wilma",
        "cognome": "Ferreira",
        "email": "wil.ferreira@email.com",
        "indirizzo": "Via Como 4",
        "ruoli": [
            {
                "id": 4,
                "nome": "ROLE_USER"
            }
        ]
    },
    {
        "id": 48,
        "username": "utente4",
        "nome": "Test nome Utente4",
        "cognome": "Test cognome Utente4",
        "email": "utente4@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": []
    },
    {
        "id": 49,
        "username": "Utente5",
        "nome": "Test nome Utente5",
        "cognome": "Test cognome Utente5",
        "email": "utente5@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": []
    },
    {
        "id": 51,
        "username": "Utente6",
        "nome": "Test nome Utente6",
        "cognome": "Test cognome Utente6",
        "email": "utente6@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": []
    },
    {
        "id": 52,
        "username": "Utente7",
        "nome": "Test nome Utente7",
        "cognome": "Test cognome Utente7",
        "email": "utente7@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": [
            {
                "id": 3,
                "nome": "ROLE_ADMIN"
            }
        ]
    },
    {
        "id": 15,
        "username": "pluto",
        "nome": "Pluto",
        "cognome": "Pluto",
        "email": "pluto@email.it",
        "indirizzo": "Viale Monza 13",
        "ruoli": [
            {
                "id": 7,
                "nome": "ROLE_EDITOR"
            },
            {
                "id": 4,
                "nome": "ROLE_USER"
            }
        ]
    },
    {
        "id": 53,
        "username": "Utente8",
        "nome": "Test nome Utente8",
        "cognome": "Test cognome Utente8",
        "email": "utente8@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": [
            {
                "id": 7,
                "nome": "ROLE_EDITOR"
            },
            {
                "id": 52,
                "nome": "RUOLO_PROVA_2"
            },
            {
                "id": 51,
                "nome": "RUOLO_PROVA_1"
            },
            {
                "id": 4,
                "nome": "ROLE_USER"
            },
            {
                "id": 3,
                "nome": "ROLE_ADMIN"
            }
        ]
    },
    {
        "id": 14,
        "username": "pippo",
        "nome": "Pippo Pippo",
        "cognome": "Pippo Pippo",
        "email": "pippo2@test.it",
        "indirizzo": "Viale Roma 5",
        "ruoli": [
            {
                "id": 4,
                "nome": "ROLE_USER"
            }
        ]
    },
    {
        "id": 17,
        "username": "pinkopallo",
        "nome": "Pinkipallino",
        "cognome": "Pinko",
        "email": "pinko@test.it",
        "indirizzo": "Corso Lodi, 18",
        "ruoli": [
            {
                "id": 30,
                "nome": "ROLE_MASTER"
            },
            {
                "id": 4,
                "nome": "ROLE_USER"
            }
        ]
    },
    {
        "id": 18,
        "username": "utente1",
        "nome": "Test nome",
        "cognome": "Test cognome",
        "email": "utente1@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": []
    },
    {
        "id": 46,
        "username": "utente2",
        "nome": "Test nome Utente2",
        "cognome": "Test cognome Utente2",
        "email": "utente2@test.it",
        "indirizzo": "Parco Sempione",
        "ruoli": [
            {
                "id": 4,
                "nome": "ROLE_USER"
            }
        ]
    },
    {
        "id": 47,
        "username": "utente3",
        "nome": "Test nome Utente3",
        "cognome": "Test cognome Utente3",
        "email": "utente3@test.it",
        "indirizzo": "Parco Nord",
        "ruoli": []
    }
]

/*
@EqualsAndHashCode.Exclude
@ManyToMany(fetch = FetchType.LAZY,
	cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REFRESH})
@JoinTable(name = "CONTRATTI_RINEGOZIATI",
	joinColumns = {@JoinColumn(name = "CTR_CONTRATTO_KEY", referencedColumnName = "CR_CONTRATTO_KEY_RINEGOZIATO", nullable = false)},
	inverseJoinColumns = {@JoinColumn(name = "CTR_CONTRATTO_KEY_NEW", referencedColumnName = "CR_CONTRATTO_KEY_NEW", nullable = false)})
@JsonIgnoreProperties("contrattiNuovi")
private Set<Contratto> contrattiRinegoziati = new HashSet<>();


@EqualsAndHashCode.Exclude
@ManyToMany(fetch = FetchType.LAZY,
	cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REFRESH})
@JoinTable(name = "CONTRATTI_RINEGOZIATI",
	joinColumns = @JoinColumn(name = "CTR_CONTRATTO_KEY"),
	inverseJoinColumns = @JoinColumn(name = "CTR_CONTRATTO_KEY_NEW"))
@JsonIgnoreProperties("contrattiNuovi")
private Set<Contratto> contrattiRinegoziati = new HashSet<>();

*/
--------------------------------------

ALTER TABLE POS_UNICO.CONTRATTI ADD (CTR_CONTRATTO_KEY_NEW  NUMBER);

-------------------------------------

=== MICROSERVICE EXAMPLE ===
° Product Info Service   ->  Basic information about the product such as title, author
° Pricing Service        ->  Product price
° Order service          ->  Purchase history for product
° Inventory service      ->  Product availability
° Review service         ->  Customer reviews
° Catalog service
° Recomendation service
° Invoice service


// String userInserimento = HazelcastUtil.readUserInfoFromCache(Constant.USER_INSERIMENTO, hazelcastInstance);
// String userAggiornamento = HazelcastUtil.readUserInfoFromCache(Constant.USER_AGGIORNAMENTO, hazelcastInstance);


-- ####################################################

spring:
    jpa:
        database: H2
        show-sql: true
        hibernate:
            ddl-auto: none
    properties:
        hibernate:
            dialect: common.H2Dialect
    datasource:
        initialize: true
        schema: schema.sql
        data: data.sql
        url: jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;Mode=Oracle;DATABASE_TO_UPPER=false;
        username:
        platform: h2
        driver-class-name: org.h2.Driver
        testWhileIdle: true
        validationQuery: SELECT 1 from DUAL
		
---------------------------------

@EnableWebSecurity
@EnableGlobalMethodSecurity(
    securedEnabled = true,
    jsr250Enabled = true,
    prePostEnabled = true
)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    // Details omitted for brevity

}

---------------------------------

SecurityMockMvcRequestPostProcessors.jwt()

spring-security-oauth2-jose


@EnableJpaAuditing


Pageable page = PageRequest.of(0, 5, new Sort(Sort.Direction.ASC, "id", "description") );

ContrattoPosRichiestoServizioPos.java (join table)


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ID_ANAGRAFICAACCOUNTAFFILIATO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_ANAGRAFICAACCOUNTAFFILIATO FOR POS_UNICO.SEQ_ID_ANAGRAFICAACCOUNTAFFILIATO;


GRANT SELECT ON POS_UNICO.SEQ_ID_ANAGRAFICAACCOUNTAFFILIATO TO IT_ROLE;


---------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ID_CONTRATTI
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_CONTRATTI FOR POS_UNICO.SEQ_ID_CONTRATTI;


GRANT SELECT ON POS_UNICO.SEQ_ID_CONTRATTI TO IT_ROLE;


----------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ID_SERVIZIOPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_SERVIZIOPOS FOR POS_UNICO.SEQ_ID_SERVIZIOPOS;


GRANT SELECT ON POS_UNICO.SEQ_ID_SERVIZIOPOS TO IT_ROLE;


----------------------------


POS_UNICO.SEQ_ID_ACCESSORIPOS ----

POS_UNICO.SEQ_ID_ANAGRAFICAACCESSORIPOS ----

POS_UNICO.SEQ_ID_ANAGRAFICACONNETTIVITAPOS ----


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ID_ANAGRAFICAEMETTITORE
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_ANAGRAFICAEMETTITORE FOR POS_UNICO.SEQ_ID_ANAGRAFICAEMETTITORE;


GRANT SELECT ON POS_UNICO.SEQ_ID_ANAGRAFICAEMETTITORE TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ID_ANAGRAFICAIBAN
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_ANAGRAFICAIBAN FOR POS_UNICO.SEQ_ID_ANAGRAFICAIBAN;


GRANT SELECT ON POS_UNICO.SEQ_ID_ANAGRAFICAIBAN TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ID_ANAGRAFICAPUNTOVENDITA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_ANAGRAFICAPUNTOVENDITA FOR POS_UNICO.SEQ_ID_ANAGRAFICAPUNTOVENDITA;


GRANT SELECT ON POS_UNICO.SEQ_ID_ANAGRAFICAPUNTOVENDITA TO IT_ROLE;


--------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_ID_ANAGRAFICASERVIZIO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_ANAGRAFICASERVIZIO FOR POS_UNICO.SEQ_ID_ANAGRAFICASERVIZIO;


GRANT SELECT ON POS_UNICO.SEQ_ID_ANAGRAFICASERVIZIO TO IT_ROLE;


-----------------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_DATITECNICIPOS_ID_RECORD
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_DATITECNICIPOS_ID_RECORD FOR POS_UNICO.SEQ_DATITECNICIPOS_ID_RECORD;


GRANT SELECT ON POS_UNICO.SEQ_DATITECNICIPOS_ID_RECORD TO IT_ROLE;


-----------------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_CTRPVEMETTITORIDICHIARATI
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_CTRPVEMETTITORIDICHIARATI FOR POS_UNICO.SEQ_CTRPVEMETTITORIDICHIARATI;


GRANT SELECT ON POS_UNICO.SEQ_CTRPVEMETTITORIDICHIARATI TO IT_ROLE;


--------------------------------------------- 


CREATE SEQUENCE POS_UNICO.SEQ_JWTSECRET
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_JWTSECRET FOR POS_UNICO.SEQ_JWTSECRET;


GRANT SELECT ON POS_UNICO.SEQ_JWTSECRET TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAREVISIONICONTRATTO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAREVISIONICONTRATTO FOR POS_UNICO.SEQ_ANAGRAFICAREVISIONICONTRATTO;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAREVISIONICONTRATTO TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICACOLLABORATORI
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICACOLLABORATORI FOR POS_UNICO.SEQ_ANAGRAFICACOLLABORATORI;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICACOLLABORATORI TO IT_ROLE;

---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAPROVORDINECOMMESSA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAPROVORDINECOMMESSA FOR POS_UNICO.SEQ_ANAGRAFICAPROVORDINECOMMESSA;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAPROVORDINECOMMESSA TO IT_ROLE;

---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICACOMMESSE
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICACOMMESSE FOR POS_UNICO.SEQ_ANAGRAFICACOMMESSE;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICACOMMESSE TO IT_ROLE;

---------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_FLUSSILAVORAZIONIVENDITA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_FLUSSILAVORAZIONIVENDITA FOR POS_UNICO.SEQ_FLUSSILAVORAZIONIVENDITA;

GRANT SELECT ON POS_UNICO.SEQ_FLUSSILAVORAZIONIVENDITA TO IT_ROLE;


--------------------------------------------- @@@@@@@@@@@@@@@ ---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_DETTAGLIOAZIONIVENDITA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_DETTAGLIOAZIONIVENDITA FOR POS_UNICO.SEQ_DETTAGLIOAZIONIVENDITA;

GRANT SELECT ON POS_UNICO.SEQ_DETTAGLIOAZIONIVENDITA TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAAZIONIVENDITA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAAZIONIVENDITA FOR POS_UNICO.SEQ_ANAGRAFICAAZIONIVENDITA;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAAZIONIVENDITA TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_LAVORAZIONIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_LAVORAZIONIUNICAPOS FOR POS_UNICO.SEQ_LAVORAZIONIUNICAPOS;

GRANT SELECT ON POS_UNICO.SEQ_LAVORAZIONIUNICAPOS TO IT_ROLE;


---------------------------------------------

SEQ_MAGAZZINOMOVIMENTITESTATA

CREATE SEQUENCE POS_UNICO.SEQ_MAGAZZINOMOVIMENTITESTATA
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_MAGAZZINOMOVIMENTITESTATA FOR POS_UNICO.SEQ_MAGAZZINOMOVIMENTITESTATA;

GRANT SELECT ON POS_UNICO.SEQ_MAGAZZINOMOVIMENTITESTATA TO IT_ROLE;


---------------------------------------------

SEQ_MAGAZZINOMOVIMENTIDETTAGLIO

CREATE SEQUENCE POS_UNICO.SEQ_MAGAZZINOMOVIMENTIDETTAGLIO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_MAGAZZINOMOVIMENTIDETTAGLIO FOR POS_UNICO.SEQ_MAGAZZINOMOVIMENTIDETTAGLIO;

GRANT SELECT ON POS_UNICO.SEQ_MAGAZZINOMOVIMENTIDETTAGLIO TO IT_ROLE;

---------------------------------------------



ALTER TABLE POS_UNICO.ANAGRAFICA_IBAN ADD CONSTRAINT ANAGRAFICA_IBAN_FK FOREIGN KEY (AIB_SOC_CODICE, AIB_CONTRATTO_KEY) REFERENCES POS_UNICO.CONTRATTI (CTR_SOC_CODICE, CTR_CONTRATTO_KEY);


ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI ADD CONSTRAINT CONTRATTI_EMETTITORI_DICHIARATI_FK1 FOREIGN KEY (CED_SOC_CODICE, CED_CONTRATTO_KEY) REFERENCES POS_UNICO.CONTRATTI (CTR_SOC_CODICE, CTR_CONTRATTO_KEY);
ALTER TABLE POS_UNICO.CONTRATTI_EMETTITORI_DICHIARATI ADD CONSTRAINT CONTRATTI_EMETTITORI_DICHIARATI_FK2 FOREIGN KEY (CED_SOC_CODICE, CED_EMETTITORE_KEY) REFERENCES POS_UNICO.ANAGRAFICA_EMETTITORI (AE_SOC_CODICE, AE_EMETTITORE_KEY);

ALTER TABLE POS_UNICO.ANAGRAFICA_PUNTI_VENDITA ADD CONSTRAINT ANAGRAFICA_PUNTI_VENDITA_PK PRIMARY KEY (APV_SOC_CODICE, APV_PUNTO_VENDITA_KEY);

ALTER TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI ADD CONSTRAINT PUNTI_VENDITA_CONTRATTI_FK1 FOREIGN KEY (PVC_SOC_CODICE, PVC_PUNTO_VENDITA_KEY) REFERENCES POS_UNICO.ANAGRAFICA_PUNTI_VENDITA (APV_SOC_CODICE, APV_PUNTO_VENDITA_KEY);
ALTER TABLE POS_UNICO.PUNTI_VENDITA_CONTRATTI ADD CONSTRAINT PUNTI_VENDITA_CONTRATTI_FK2 FOREIGN KEY (PVC_SOC_CODICE, PVC_CONTRATTO_KEY) REFERENCES POS_UNICO.CONTRATTI (CTR_SOC_CODICE, CTR_CONTRATTO_KEY);

ALTER TABLE POS_UNICO.CONTRATTI_POS_RICHIESTI ADD CONSTRAINT CONTRATTI_POS_RICHIESTI_PK PRIMARY KEY (CPR_SOC_CODICE, CPR_CONTRATT_POS_RICHIESTO_KEY);

ALTER TABLE POS_UNICO.CONTRATTI_POS_RICHIESTI_CONTRATTI ADD CONSTRAINT CONTRATTI_POS_RICHIESTI_CONTRATTI_FK1 FOREIGN KEY (CPRC_SOC_CODICE, CPRC_POS_RICHIESTO_KEY) REFERENCES POS_UNICO.CONTRATTI_POS_RICHIESTI (CPR_SOC_CODICE, CPR_CONTRATT_POS_RICHIESTO_KEY);
ALTER TABLE POS_UNICO.CONTRATTI_POS_RICHIESTI_CONTRATTI ADD CONSTRAINT CONTRATTI_POS_RICHIESTI_CONTRATTI_FK2 FOREIGN KEY (CPRC_SOC_CODICE, CPRC_CONTRATTO_KEY) REFERENCES POS_UNICO.CONTRATTI (CTR_SOC_CODICE, CTR_CONTRATTO_KEY);


---------------------------------------------


ALTER TABLE POS_UNICO.SERVIZI_POS ADD CONSTRAINT SERVIZI_POS_FK2 FOREIGN KEY (SVP_SOC_CODICE, SVP_CONTRATT_POS_RICHIESTO_KEY) REFERENCES POS_UNICO.CONTRATTI_POS_RICHIESTI (CPR_SOC_CODICE, CPR_CONTRATT_POS_RICHIESTO_KEY);


ALTER TABLE POS_UNICO.SERVIZI_POS ADD CONSTRAINT SERVIZI_POS_UNIQUE UNIQUE (SVP_SOC_CODICE, SVP_SERVIZIO_POS_KEY, SVP_SERVIZIO_KEY, SVP_CONTRATT_POS_RICHIESTO_KEY);


---------------------------------------------------------------------


ALTER TABLE POS_UNICO.SERVIZI_POS ADD CONSTRAINT SERVIZI_POS_UNIQUE UNIQUE (SVP_SOC_CODICE, SVP_SERVIZIO_POS_KEY, SVP_SERVIZIO_KEY, SVP_CONTRATT_POS_RICHIESTO_KEY);

ALTER TABLE POS_UNICO.TIPOLOGIA_POS DROP CONSTRAINT TIPOLOGIA_POS_FK;
ALTER TABLE POS_UNICO.TIPOLOGIA_POS DROP CONSTRAINT TIPOLOGIA_POS_FK2;

ALTER TABLE POS_UNICO.TIPOLOGIA_POS ADD CONSTRAINT TIPOLOGIA_POS_FK FOREIGN KEY (TPO_SOC_CODICE, TPO_ANAGRAF_TIPOLOGIA_POS_KEY) REFERENCES POS_UNICO.ANAGRAFICA_TIPOLOGIE_POS (ATP_SOC_CODICE, ATP_ANAGRAF_TIPOLOGIA_POS_KEY);

ALTER TABLE POS_UNICO.TIPOLOGIA_POS ADD CONSTRAINT TIPOLOGIA_POS_FK2 FOREIGN KEY (TPO_DATI_TECNICI_POS_KEY) REFERENCES POS_UNICO.DATI_TECNICI_POS (DTP_DATI_TECNICI_POS_KEY);


---------------------------------------------------------------------


ALTER TABLE POS_UNICO.ACCESSORI_POS DROP CONSTRAINT ACCESSORI_POS_FK;
ALTER TABLE POS_UNICO.ACCESSORI_POS DROP CONSTRAINT ACCESSORI_POS_FK2;

ALTER TABLE POS_UNICO.ACCESSORI_POS ADD CONSTRAINT ACCESSORI_POS_FK FOREIGN KEY (APO_SOC_CODICE, APO_ANAGRAFICA_ACCESSORI_KEY) REFERENCES POS_UNICO.ANAGRAFICA_ACCESSORI_POS (AAP_SOC_CODICE, AAP_ANAGRAFICA_ACCESSORI_KEY);

ALTER TABLE POS_UNICO.ACCESSORI_POS ADD CONSTRAINT ACCESSORI_POS_FK2 FOREIGN KEY (APO_DATI_TECNICI_POS_KEY) REFERENCES POS_UNICO.DATI_TECNICI_POS (DTP_DATI_TECNICI_POS_KEY);


---------------------------------------------------------------------


ALTER TABLE POS_UNICO.CONNETTIVITA_POS DROP CONSTRAINT CONNETTIVITA_POS_FK;
ALTER TABLE POS_UNICO.CONNETTIVITA_POS DROP CONSTRAINT CONNETTIVITA_POS_FK2;

ALTER TABLE POS_UNICO.CONNETTIVITA_POS ADD CONSTRAINT CONNETTIVITA_POS_FK FOREIGN KEY (CPO_SOC_CODICE, CPO_ANAGRAF_CONNETTIVITA_KEY) REFERENCES POS_UNICO.ANAGRAFICA_CONNETTIVITA_POS (ACP_SOC_CODICE, ACP_ANAGRAF_CONNETTIVITA_KEY);

ALTER TABLE POS_UNICO.CONNETTIVITA_POS ADD CONSTRAINT CONNETTIVITA_POS_FK2 FOREIGN KEY (CPO_DATI_TECNICI_POS_KEY) REFERENCES POS_UNICO.DATI_TECNICI_POS (DTP_DATI_TECNICI_POS_KEY);


---------------------------------------------------------------------
ALTER TABLE POS_UNICO.ACCESSORI_POS DROP PRIMARY KEY CASCADE;

DROP INDEX POS_UNICO.ACCESSORI_POS_PK;

ALTER TABLE POS_UNICO.ACCESSORI_POS ADD CONSTRAINT ACCESSORI_POS_PK PRIMARY KEY (APO_SOC_CODICE, APO_ACCESSORI_KEY);

ALTER TABLE POS_UNICO.ACC_POS_ANAGRAFICA_ACC_POS ADD CONSTRAINT ACCPOSANAGRAFICAACCPOS_FK1 FOREIGN KEY (ACC_SOC_CODICE, ACC_ACCESSORI_KEY) REFERENCES POS_UNICO.ACCESSORI_POS (APO_SOC_CODICE, APO_ACCESSORI_KEY);
ALTER TABLE POS_UNICO.ACC_POS_ANAGRAFICA_ACC_POS ADD CONSTRAINT ACCPOSANAGRAFICAACCPOS_FK2 FOREIGN KEY (ACC_SOC_CODICE, ACC_ANAGRAFICA_ACCESSORI_KEY) REFERENCES POS_UNICO.ANAGRAFICA_ACCESSORI_POS (AAP_SOC_CODICE, AAP_ANAGRAFICA_ACCESSORI_KEY);

---------------------------------------------------------------------


ALTER TABLE POS_UNICO.CONNETTIVITA_POS DROP PRIMARY KEY CASCADE;

DROP INDEX POS_UNICO.CONNETTIVITA_POS_PK;

ALTER TABLE POS_UNICO.CONNETTIVITA_POS ADD CONSTRAINT CONNETTIVITA_POS_PK PRIMARY KEY (CPO_SOC_CODICE, CPO_CONNETTIVITA_KEY);

ALTER TABLE POS_UNICO.CON_POS_ANAGRAFICA_CON_POS ADD CONSTRAINT CONPOSANAGRAFICACONPOS_FK1 FOREIGN KEY (CON_SOC_CODICE, CON_CONNETTIVITA_KEY) REFERENCES POS_UNICO.CONNETTIVITA_POS (CPO_SOC_CODICE, CPO_CONNETTIVITA_KEY);
ALTER TABLE POS_UNICO.CON_POS_ANAGRAFICA_CON_POS ADD CONSTRAINT CONPOSANAGRAFICACONPOS_FK2 FOREIGN KEY (CON_SOC_CODICE, CON_ANAGRAF_CONNETTIVITA_KEY) REFERENCES POS_UNICO.ANAGRAFICA_CONNETTIVITA_POS (ACP_SOC_CODICE, ACP_ANAGRAF_CONNETTIVITA_KEY);


--------------------------------------------------------------------

ALTER TABLE POS_UNICO.TIPOLOGIA_POS DROP PRIMARY KEY CASCADE;

DROP INDEX POS_UNICO.TIPOLOGIA_POS_PK;

ALTER TABLE POS_UNICO.TIPOLOGIA_POS ADD CONSTRAINT TIPOLOGIA_POS_PK PRIMARY KEY (TPO_SOC_CODICE, TPO_TIPOLOGIA_POS_KEY);

ALTER TABLE POS_UNICO.TIP_POS_ANAGRAFICA_TIP_POS ADD CONSTRAINT TIPPOSANAGRAFICATIPPOS_FK1 FOREIGN KEY (TIP_SOC_CODICE, TIP_TIPOLOGIA_POS_KEY) REFERENCES POS_UNICO.TIPOLOGIA_POS (TPO_SOC_CODICE, TPO_TIPOLOGIA_POS_KEY);
ALTER TABLE POS_UNICO.TIP_POS_ANAGRAFICA_TIP_POS ADD CONSTRAINT TIPPOSANAGRAFICATIPPOS_FK2 FOREIGN KEY (TIP_SOC_CODICE, TIP_ANAGRAF_TIPOLOGIA_POS_KEY) REFERENCES POS_UNICO.ANAGRAFICA_TIPOLOGIE_POS (ATP_SOC_CODICE, ATP_ANAGRAF_TIPOLOGIA_POS_KEY);

--------------------------------------------------------------------

CREATE TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI (
  CED_EMETTITORE_DICHIARATO_KEY 	NUMBER NOT NULL,
  CED_SOC_CODICE      				NUMBER NOT NULL,
  CED_CONTRATTO_KEY   				NUMBER,
  CED_EMETTITORE_KEY  				NUMBER,
  CED_PV_KEY 						NUMBER,
  CED_ID_CONTRATTO    				VARCHAR2(10 BYTE),
  CED_ID_EMETTITORE   				VARCHAR2(10 BYTE),
  CED_ID_PV							VARCHAR2(10 BYTE),
  CED_DTINS           				DATE,
  CED_USER_INS         				VARCHAR2(20 BYTE),
  CED_DTAGG           				DATE,
  CED_USER_AGG         				VARCHAR2(20 BYTE),
  VERSION                   		NUMBER
);

ALTER TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI 
ADD CONSTRAINT CONTRATTI_PV_EMETTITORI_DICHIARATI_PK PRIMARY KEY (CED_SOC_CODICE, CED_EMETTITORE_DICHIARATO_KEY);

ALTER TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI 
ADD CONSTRAINT CONTRATTI_PV_EMETTITORI_DICHIARATI_FK1 
FOREIGN KEY (CED_SOC_CODICE, CED_CONTRATTO_KEY) 
REFERENCES POS_UNICO.CONTRATTI (CTR_SOC_CODICE, CTR_CONTRATTO_KEY);


ALTER TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI 
ADD CONSTRAINT CONTRATTI_PV_EMETTITORI_DICHIARATI_FK2
FOREIGN KEY (CED_SOC_CODICE, CED_EMETTITORE_KEY) 
REFERENCES POS_UNICO.ANAGRAFICA_EMETTITORI (AE_SOC_CODICE, AE_EMETTITORE_KEY);


ALTER TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI 
ADD CONSTRAINT CONTRATTI_PV_EMETTITORI_DICHIARATI_FK3 
FOREIGN KEY (CED_SOC_CODICE, CED_PUNTO_VENDITA_KEY) 
REFERENCES POS_UNICO.ANAGRAFICA_PUNTI_VENDITA (APV_SOC_CODICE, APV_PUNTO_VENDITA_KEY);


CREATE OR REPLACE PUBLIC SYNONYM CONTRATTI_PV_EMETTITORI_DICHIARATI FOR POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI TO IT_ROLE;

--------------------------------------------------------------------

CREATE UNIQUE INDEX POS_UNICO.ANAGRAFICA_ACCESSORIO_POS_ID_UQ ON POS_UNICO.ANAGRAFICA_ACCESSORI_POS (AAP_ID_ACCESSORIO);

CREATE UNIQUE INDEX POS_UNICO.UTENTE_EMAIL_UNQ ON POS_UNICO.UTENTE(EMAIL);



--------------------------------------------------------------------

List list = Arrays.asList(new String[]{"SomeValue1", "SomeValue1"});
Expression inExpression = root.get( TestRecord_.eventType);
Predicate inPredicate = inExpression.in(list);
if (eventType != null && !eventType.isEmpty()) {
    predicates.add(builder.and(builder.equal(inPredicate)));
}


-- ###################################################################

@Query("select c.posRichiestoKey from ContrattoPosRichiesto c")
Page<Long> findAllPosRichiestoKeys(Pageable pageable);

@Query("select p from ContrattoPosRichiesto p left join fetch p.puntoVendita " +
	"left join fetch p.serviziPos left join fetch p.datiTecnici where p.posRichiestoKey in (:posRichiestoKeys)")
List<ContrattoPosRichiesto> findAllPosRichiestiByKeyInList(@Param("posRichiestoKeys") List<Long> posRichiestoKeys);

---------------

@Override
public Page<AnagraficaAccountAffiliato> findAllAffiliati(Pageable pageRequest) {
	Pageable currentPage = PageRequest.of(pageRequest.getPageNumber(),
			pageRequest.getPageSize(), Sort.by("accountKey").ascending());

	/* findAllAccountKeys(currentPage) and findByAccountKeyIn(primaryKeys) together, they are a workaround to fix the bug on Pageable query */
	Page<Long> pageOfPrimaryKeys = affiliatoRepository.findAllAccountKeys(currentPage);
	List<Long> primaryKeys = pageOfPrimaryKeys.getContent();
	List<AnagraficaAccountAffiliato> affiliatoList = affiliatoRepository.findByAccountKeyIn(primaryKeys);
	return new PageImpl<>(affiliatoList, currentPage, pageOfPrimaryKeys.getTotalPages());
}

-- ###################################################################

Stati del Contratto: "Inserito/Validato/Rinegoziato/Annullato/Disdetto"

-- ###################################################################

"UPDATE POS_UNICO.TIP_POS_ANAGRAFICA_TIP_POS SET TIP_ANAGRAF_TIPOLOGIA_POS_KEY = :TIP_ANAGRAF_TIPOLOGIA_POS_KEY, TIP_ID_TIPOLOGIA = :TIP_ID_TIPOLOGIA " +
"WHERE  TIP_TIPOLOGIA_POS_KEY = :TIP_TIPOLOGIA_POS_KEY AND TIP_ANAGRAF_TIPOLOGIA_POS_KEY = :TIP_ANAGRAF_TIPOLOGIA_POS_KEY AND TIP_ID_TIPOLOGIA = :TIP_ID_TIPOLOGIA";

SELECT * FROM (SELECT
		tip.TIP_ANAGRAF_TIPOLOGIA_POS_KEY,
		tip.TIP_TIPOLOGIA_POS_KEY,
		tip.TIP_SOC_CODICE,
		tip.TIP_ID_TIPOLOGIA 
FROM POS_UNICO.TIP_POS_ANAGRAFICA_TIP_POS tip 
WHERE tip.TIP_ANAGRAF_TIPOLOGIA_POS_KEY = ? 
AND tip.TIP_TIPOLOGIA_POS_KEY = ? AND UPPER(tip.TIP_ID_TIPOLOGIA)=?) 


-- ##################################################################

public class JavaClientCallLogBea {
	private String jccIdChiamata;
	private String jccMessage; // JSON Message
	private String jccUser;
	private String jccClass;
	private String jccMethod;
	private String jccLogLevel;
	
	public JavaClientCallLogBea() {
	}
}


private void insertJsonString(Connection connection, JavaClientCallLogBean bean) throws SQLException {
   connection = new oracle.jdbc.OracleDriver().defaultConnection();
   try {
	   CallableStatement clbStmt = connection.prepareCall("{call BIRD.LOG_JAVA_CLIENT_CALL(?, ?, ?, ?, ?, ?, ?)}");
	   clbStmt.setString(1, bean.getJccIdChiamata());

	   oracle.sql.CLOB newClob = oracle.sql.CLOB.createTemporary(connection, false, oracle.sql.CLOB.DURATION_CALL);
	   newClob.putString(1, bean.getJccMessage());
	   clbStmt.setClob(2, newClob);

	   clbStmt.setDate(3, new java.sql.Date(System.currentTimeMillis()));
	   clbStmt.setString(4, bean.getJccUser());
	   clbStmt.setString(5, bean.getJccClass());
	   clbStmt.setString(6, bean.getJccMethod());
	   clbStmt.setString(7, bean.getJccLogLevel());
	   clbStmt.executeUpdate();
	   clbStmt.close();
   } catch (SQLException ex) {
	System.out.println("ERRORE: " + ex.getMessage());
   }
}

-- ##################################################################

import oracle.jdbc.driver.*;
public class TestBlob {

  public static oracle.sql.BLOB getBlob(String inputString) throws Exception {
    oracle.jdbc.OracleConnection conn = new OracleDriver().defaultConnection();
    oracle.sql.BLOB retBlob = oracle.sql.BLOB.createTemporary(conn, true, oracle.sql.BLOB.DURATION_SESSION);
    java.io.OutputStream outStr = retBlob.setBinaryStream(0);
    outStr.write(inputString.getBytes());
    outStr.flush();
    return retBlob;
  }
}

-- ##################################################################

oracle.sql.BLOB class is deprecated and replaced with the oracle.jdbc.OracleBlob interface

-- ##################################################################

java -Dspring.config.location=environments/config/dev/application.yaml -jar ./target/pos-unico-rest-service-0.0.1-SNAPSHOT.jar

ALTER TABLE POS_UNICO.SERVIZI_POS ADD CONSTRAINT SERVIZI_POS_FK3 FOREIGN KEY (SVP_ANAGRAFICA_SERVIZIO_KEY) REFERENCES POS_UNICO.ANAGRAFICA_SERVIZI (AS_SERVIZIO_KEY);

ALTER TABLE POS_UNICO.SERVIZI_POS ADD CONSTRAINT SERVIZI_POS_FK3 FOREIGN KEY (SVP_ANAGRAFICA_SERVIZIO_KEY) REFERENCES POS_UNICO.ANAGRAFICA_SERVIZI (AS_SERVIZIO_KEY);


-- ##################################################################


ALTER TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI ADD CONSTRAINT EMETTITORI_DICHIARATI_UNQ 
UNIQUE (CED_EMETTITORE_DICHIARATO_KEY, CED_CONTRATTO_KEY, CED_ID_EMETTITORE, CED_PV_KEY, CED_SOC_CODICE);
ALTER TABLE POS_UNICO.CONTRATTI_PV_EMETTITORI_DICHIARATI DROP CONSTRAINT EMETTITORI_DICHIARATI_UNQ;


java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005 target/gs-scheduling-tasks-0.1.0.jar


-Dspring-boot.run.jvmArguments="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"


mvn spring-boot:run -Dspring-boot.run.jvmArguments="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"


java -jar /target/pos-unico-rest-service.jar -Dspring-boot.run.jvmArguments="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"


Adobe Online PDF Converter: https://www.adobe.com/it/acrobat/online/word-to-pdf.html


C:\\Users\\aferreir\\Downloads\\salvataggio-contratto.pdf


predicateList.add(criteriaBuilder.or(
		criteriaBuilder.isNull(root.get(PosRichiesteTermId_.flagElaborazione)),
		criteriaBuilder.equal(root.get(PosRichiesteTermId_.flagElaborazione), "N")));
		
predicateList.add(criteriaBuilder.and(criteriaBuilder.gt(root.get(PosRichiesteTermId_.retryNumber), 0)));


criteriaBuilder.equal(root.get(CodificaTerminaleEmettitoreTestata_.dettaglio).get(CodificaTerminaleEmettitoreDettaglio_.idTestataRef), idTestata.trim())


predicateList.add(criteriaBuilder.or(
		criteriaBuilder.equal(root.get(Contratto_.stato), StatoContrattoEnum.INSERITO),
		criteriaBuilder.equal(root.get(Contratto_.stato), StatoContrattoEnum.INSERITO)));


{
  "idPdv": "string",
  "terminali": [
    {
      "codEmettitori": [
        {
          "emettitore": "EMET_ESEMPIO",
          "codTerminale": 5678
        }
      ],
      "idQsave": 678,
      "id": "trm_ff-1234"
    }
  ]
}


logging:
  level:
    root: "warn"
    org.hibernate: "error"
    org.springframework.web: "debug" (limit output with "trace" or with "info")
	it.fastpoint.amedea.api: "debug"


#For sorting endpoints alphabetically
springdoc.swagger-ui.operationsSorter=alpha
#For sorting tags alphabetically
springdoc.swagger-ui.tagsSorter=alpha


---------------------------------------------------------------------------------

CREATE TABLE POS_UNICO.FLUSSI_VENDITA_CONTRATTI (
	FVCT_FLUSSO_LAVORAZIONE_KEY NUMBER NOT NULL,
	FVCT_CONTRATTO_KEY NUMBER NOT NULL
);

ALTER TABLE POS_UNICO.FLUSSI_VENDITA_CONTRATTI ADD CONSTRAINT FLUSSI_VENDITA_CONTRATTI_PK PRIMARY KEY(FVCT_FLUSSO_LAVORAZIONE_KEY, FVCT_CONTRATTO_KEY);

ALTER TABLE POS_UNICO.FLUSSI_VENDITA_CONTRATTI ADD CONSTRAINT FLUSSI_VENDITA_CONTRATTI_FK1 FOREIGN KEY (FVCT_FLUSSO_LAVORAZIONE_KEY) REFERENCES POS_UNICO.FLUSSI_LAVORAZIONI_VENDITA (FLUSSO_LAVORAZIONE_KEY);
ALTER TABLE POS_UNICO.FLUSSI_VENDITA_CONTRATTI ADD CONSTRAINT FLUSSI_VENDITA_CONTRATTI_FK2 FOREIGN KEY (FVCT_CONTRATTO_KEY) REFERENCES POS_UNICO.CONTRATTI (CONTRATTO_KEY);

CREATE OR REPLACE PUBLIC SYNONYM FLUSSI_VENDITA_CONTRATTI FOR POS_UNICO.FLUSSI_VENDITA_CONTRATTI;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.FLUSSI_VENDITA_CONTRATTI TO IT_ROLE;


---------------------------------------------------------------------------------

CREATE TABLE POS_UNICO.FLUSSI_VENDITA_PUNTI_VENDITA (
    FVPV_FLUSSO_LAVORAZIONE_KEY NUMBER NOT NULL,
    FVPV_PUNTI_VENDITA_KEY NUMBER NOT NULL
);

ALTER TABLE POS_UNICO.FLUSSI_VENDITA_PUNTI_VENDITA ADD CONSTRAINT FLUSSI_VENDITA_PUNTI_VENDITA_PK PRIMARY KEY(FVCT_FLUSSO_LAVORAZIONE_KEY, FVPV_PUNTI_VENDITA_KEY);

ALTER TABLE POS_UNICO.FLUSSI_VENDITA_PUNTI_VENDITA ADD CONSTRAINT FLUSSI_VENDITA_PUNTI_VENDITA_FK1 FOREIGN KEY (FVCT_FLUSSO_LAVORAZIONE_KEY) REFERENCES POS_UNICO.FLUSSI_LAVORAZIONI_VENDITA (FLV_FLUSSO_LAVORAZIONE_KEY);
ALTER TABLE POS_UNICO.FLUSSI_VENDITA_PUNTI_VENDITA ADD CONSTRAINT FLUSSI_VENDITA_PUNTI_VENDITA_FK2 FOREIGN KEY (FVPV_PUNTI_VENDITA_KEY) REFERENCES POS_UNICO.CONTRATTI (CTR_PUNTI_VENDITA_KEY);

CREATE OR REPLACE PUBLIC SYNONYM FLUSSI_VENDITA_PUNTI_VENDITA FOR POS_UNICO.FLUSSI_VENDITA_PUNTI_VENDITA;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.FLUSSI_VENDITA_PUNTI_VENDITA TO IT_ROLE;


//////////////////////////////////////////


@Operation(summary = "Ritorna la lista degli Stati di Azione Vendita",
            description = "Ritorna la lista di tutti gli Stati di Azione Vendita Disponibili")
@ApiResponses(value = {
	@ApiResponse(responseCode = "200", description = "OK",
			content = {@Content(mediaType = "application/json",
					array = @ArraySchema(schema = @Schema(implementation = String.class))
			)}),
	@ApiResponse(responseCode = "500", description = "Internal Server Error",
		content = {@Content(mediaType = "application/json",
		schema = @Schema(implementation = ErrorMessageDetail.class))})
})
@GetMapping("/list/statiAzioneVenditaDisponibili")
public ResponseEntity<List<String>> findAllStatiAzioneVendita() throws SomethingWentWrongGeneralException {
	log.info("Ritorna la lista di tutti gli Stati di Azione Vendita Disponibili ...");
	try {
		List<String> statoAzioneVenditaStringList =
				CustomFlussoLavorazioneVenditaMapper.statoAzioneVenditaEnumToStatoAzioneVenditaStringList(
						StatoAzioneVenditaEnum.values());

		return ResponseEntity.ok().body(statoAzioneVenditaStringList);
	} catch (Exception ex) {
		log.debug("ERROR: FlussoLavorazioneVenditaController.findAllStatiAzioneVendita :: E' accaduto un " +
				"errore: {}", ex.getMessage());
		throw new SomethingWentWrongGeneralException(ex.getMessage());
	}
}


public static List<String> statoAzioneVenditaEnumToStatoAzioneVenditaStringList(
            StatoAzioneVenditaEnum[] statoAzioneVenditaEnumValues) {

	return Arrays.stream(statoAzioneVenditaEnumValues)
			.map(StatoAzioneVenditaEnum::name)
			.collect(Collectors.toCollection(ArrayList::new));
}


-----------------


SELECT * FROM POS_UNICO.FLUSSI_LAVORAZIONI_VENDITA
WHERE FLV_FLUSSO_LAVORAZIONE_KEY <> 1
AND FLV_SOC_EMETTITRICE_ORIGINE <> 6
AND FLV_FLUSSO_MASTER_KEY IS NULL
AND FLV_PARTITA_IVA_PV IN (
      SELECT FLV_PARTITA_IVA_PV FROM POS_UNICO.FLUSSI_LAVORAZIONI_VENDITA
      WHERE FLV_FLUSSO_MASTER_KEY IS NULL
      --AND FLV_UTENTE_ASSEGNATARIO_KEY IS NULL
      AND FLV_FLUSSO_LAVORAZIONE_KEY <> 1
      AND FLV_PARTITA_IVA_PV = '01234567891' GROUP BY FLV_PARTITA_IVA_PV HAVING COUNT(FLV_PARTITA_IVA_PV) >= 1
      AND FLV_SOC_EMETTITRICE_ORIGINE <> 6 GROUP BY FLV_SOC_EMETTITRICE_ORIGINE HAVING COUNT(FLV_SOC_EMETTITRICE_ORIGINE) = 1)
ORDER BY FLV_FLUSSO_LAVORAZIONE_KEY;

--------------------------

Tabelle database  

Terminali: pos_unico.terminali_unicapos 

Sim:  pos_unico.sim_terminali_unicapos 

Barcode reader: pos_unico.barcode_reader_terminali_unicapos 


-- ##############################################################################################

CREATE TABLE POS_UNICO.EXCEL_UPLOAD_TEST (
	ID NUMBER NOT NULL,
	TITLE VARCHAR2(50),
	DESCRIPTION VARCHAR2(100),
	PUBLISHED NUMBER(1),
	VARSION NUMBER
);

ALTER TABLE POS_UNICO.EXCEL_UPLOAD_TEST ADD CONSTRAINT EXCEL_UPLOAD_TEST_PK PRIMARY KEY (ID);

CREATE OR REPLACE PUBLIC SYNONYM EXCEL_UPLOAD_TEST FOR POS_UNICO.EXCEL_UPLOAD_TEST;

GRANT DELETE, INSERT, SELECT, UPDATE ON POS_UNICO.EXCEL_UPLOAD_TEST TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_EXCEL_UPLOAD_TEST
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_EXCEL_UPLOAD_TEST FOR POS_UNICO.SEQ_EXCEL_UPLOAD_TEST;

GRANT SELECT ON POS_UNICO.SEQ_EXCEL_UPLOAD_TEST TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICATIPOLOGIAMATERIALE
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICATIPOLOGIAMATERIALE FOR POS_UNICO.SEQ_ANAGRAFICATIPOLOGIAMATERIALE;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICATIPOLOGIAMATERIALE TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAMODELLITERMINALI
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAMODELLITERMINALI FOR POS_UNICO.SEQ_ANAGRAFICAMODELLITERMINALI;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAMODELLITERMINALI TO IT_ROLE;


--------------------------------------------- ANAGRAFICAMODELLISIM

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAMODELLIBARCODEREADER FOR POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAMODELLIBARCODEREADER FOR POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAMODELLISIM
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAMODELLISIM FOR POS_UNICO.SEQ_ANAGRAFICAMODELLISIM;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAMODELLISIM TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAMAGAZZINIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAMAGAZZINIUNICAPOS FOR POS_UNICO.SEQ_ANAGRAFICAMAGAZZINIUNICAPOS;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAMAGAZZINIUNICAPOS TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_LOGTERMINALIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_LOGTERMINALIUNICAPOS FOR POS_UNICO.SEQ_LOGTERMINALIUNICAPOS;

GRANT SELECT ON POS_UNICO.SEQ_LOGTERMINALIUNICAPOS TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_LOGSIMTERMINALIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_LOGSIMTERMINALIUNICAPOS FOR POS_UNICO.SEQ_LOGSIMTERMINALIUNICAPOS;

GRANT SELECT ON POS_UNICO.SEQ_LOGSIMTERMINALIUNICAPOS TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_LOGBARCODEREADERUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_LOGBARCODEREADERUNICAPOS FOR POS_UNICO.SEQ_LOGBARCODEREADERUNICAPOS;

GRANT SELECT ON POS_UNICO.SEQ_LOGBARCODEREADERUNICAPOS TO IT_ROLE;


---------------------------------------------

CREATE SEQUENCE POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ANAGRAFICAMODELLIBARCODEREADER FOR POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER;

GRANT SELECT ON POS_UNICO.SEQ_ANAGRAFICAMODELLIBARCODEREADER TO IT_ROLE;


---------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ID_SCARICO_MASSIVO_POS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_SCARICO_MASSIVO_POS FOR POS_UNICO.SEQ_ID_SCARICO_MASSIVO_POS;

GRANT SELECT ON POS_UNICO.SEQ_ID_SCARICO_MASSIVO_POS TO IT_ROLE;


---------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ID_SCARICO_MASSIVO_SIM
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_SCARICO_MASSIVO_SIM FOR POS_UNICO.SEQ_ID_SCARICO_MASSIVO_SIM;

GRANT SELECT ON POS_UNICO.SEQ_ID_SCARICO_MASSIVO_SIM TO IT_ROLE;


---------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_ID_SCARICO_MASSIVO_BCR
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_ID_SCARICO_MASSIVO_BCR FOR POS_UNICO.SEQ_ID_SCARICO_MASSIVO_BCR;

GRANT SELECT ON POS_UNICO.SEQ_ID_SCARICO_MASSIVO_BCR TO IT_ROLE;


---------------------------------------------


CREATE SEQUENCE POS_UNICO.SEQ_LOGLAVORAZIONIUNICAPOS
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9999999999999999999999999999
	NOCACHE 
	NOCYCLE 
	NOORDER 
	NOKEEP
	GLOBAL;

CREATE OR REPLACE PUBLIC SYNONYM SEQ_LOGLAVORAZIONIUNICAPOS FOR POS_UNICO.SEQ_LOGLAVORAZIONIUNICAPOS;

GRANT SELECT ON POS_UNICO.SEQ_LOGLAVORAZIONIUNICAPOS TO IT_ROLE;


-- ##############################################################################################


mvn archetype:generate -DinteractiveMode=false -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DgroupId=org.wildfly.quickstarts -DartifactId=microprofile-jwt -Dversion=1.0.0.Alpha1-SNAPSHOT
	
	
mvn archetype:generate -DinteractiveMode=false -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DgroupId=com.adiferreira.blog -DartifactId=kafka-wildfly-app -DarchetypeVersion=0.0.1-SNAPSHOT

/******************************************************************************************/
username: alyson, id: 76, password: bossy ($2a$10$5ZqY8xkmlEiFGtPUw/3siuX0CpEtV1W2n3u/aIJUV6nSSm92ckcWG)

admin: ($2a$10$EjSOBXTTuU0mnWKyZf5QwOcdPcAZOd9Iw20TiOKJI09zGGiNCzxjW)
eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvUG9zVW5pY29SZXN0U2VydmljZS9wb3NfdW5pY28vYXBpL3YxL2xvZ2luIiwic3ViIjoiYWx5c29uIiwiZXhwIjoxNzMyOTc2NzQ1LCJpYXQiOjE3MzI4OTAzNDUsInJvbGVzIjpbIlJPTEVfUFJPRklMT19BTU1JTklTVFJBVElWTyIsIlJPTEVfUFJPRklMT19BTU1JTklTVFJBVElWT19SRVNQIl19.KBcXSzX-LVTzISZp3Uic_TK2BPEJiBHBTxt1SuHkPew

84	ROLE_PROFILO_AMMINISTRATIVO
87	ROLE_PROFILO_AMMINISTRATIVO_RESP

Token:
eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvUG9zVW5pY29SZXN0U2VydmljZS9wb3NfdW5pY28vYXBpL3YxL2xvZ2luIiwic3ViIjoiYWx5c29uIiwiZXhwIjoxNzI3Nzc1NzExLCJpYXQiOjE3Mjc2ODkzMTEsInJvbGVzIjpbIlJPTEVfUFJPRklMT19BTU1JTklTVFJBVElWTyIsIlJPTEVfUFJPRklMT19BTU1JTklTVFJBVElWT19SRVNQIl19.7GV-f6xlQCR2tp4arOWNxUzSSza27nlGZw7jB5vN5ec

-----------------
testataMovimentoMagazzinoKey
username: lara, id: 5, password: swaggstyle
88	ROLE_CONFIGURAZIONE_SW

Token:
eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vaW50ZXJuYWwtYW1lZGVhLXJlc3QtMTkxNjU0MDUxOC5ldS1jZW50cmFsLTEuZWxiLmFtYXpvbmF3cy5jb206ODA4Ny9Qb3NVbmljb1Jlc3RTZXJ2aWNlL3Bvc191bmljby9hcGkvdjEvbG9naW4iLCJzdWIiOiJsYXJhIiwiZXhwIjoxNzIyNDIxMDkyLCJpYXQiOjE3MjIzMzQ2OTIsInJvbGVzIjpbIlJPTEVfQ09ORklHVVJBWklPTkVfU1ciXX0.WZ0u5gpr0Q0HMUbU4JOj22utTRlHcH1oB7oHsHhTM5Q

-----------------

username: wilma, id: 6, password: flyteen
84	ROLE_PROFILO_AMMINISTRATIVO

Token:
eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vaW50ZXJuYWwtYW1lZGVhLXJlc3QtMTkxNjU0MDUxOC5ldS1jZW50cmFsLTEuZWxiLmFtYXpvbmF3cy5jb206ODA4Ny9Qb3NVbmljb1Jlc3RTZXJ2aWNlL3Bvc191bmljby9hcGkvdjEvbG9naW4iLCJzdWIiOiJ3aWxtYSIsImV4cCI6MTcyMTcyMDQ5OSwiaWF0IjoxNzIxNjM0MDk5LCJyb2xlcyI6WyJST0xFX1BST0ZJTE9fQU1NSU5JU1RSQVRJVk8iXX0.eOidoUQEqFtolfjD8pKdXiGUPWKR9cWpW-mjFZQbLNw

-----------------

username: brandon, id: 7, password: cooldude
96	ROLE_PROFILO_TECNICO

Token:
eyJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvUG9zVW5pY29SZXN0U2VydmljZS9wb3NfdW5pY28vYXBpL3YxL2xvZ2luIiwic3ViIjoiYnJhbmRvbiIsImV4cCI6MTcyNjEyODI0MCwiaWF0IjoxNzI2MDQxODQwLCJyb2xlcyI6WyJST0xFX1BST0ZJTE9fVEVDTklDTyJdfQ.2YOrMxchObK41CJbL0wKYu88HSMNi8Eu3hFZWoHNU5Y

-----------------

id: 5, 6, 7, 76


@PostMapping(value = "/upload", 
		consumes = {MediaType.APPLICATION_JSON_VALUE, MediaType.MULTIPART_FORM_DATA_VALUE}, 
		produces = MediaType.APPLICATION_JSON_VALUE)


@Parameter(name = "file", description = "File Excel da caricare")
@RequestParam("file") MultipartFile file


/////////////////////////////////////////// 


{ 
    "tipologiaMateriale": "TERMINALI", 
    "statoCaricamento": "NUOVO" 
    "tipologiaMovimento":"IN" 
    "produttore": "INGENICO", 
    "modello": "DESK 2600", 
    "operatore": null, 
    "magazzino": "AMEDEA_01", 
    "documentoDiTrasporto": "TODO", 
    "nomeFileExcel": "SERIALI_DV_2054109644_6100890470 - Copia (2-2).xlsx" 
} 

-- ##############################################################################

{ "tipologiaMateriale": "TERMINALI", "statoCaricamento": "RICONDIZIONATO", "tipologiaMovimento":"IN", "produttore": "INGENICO", "modello": "MOVE 2500", "operatore": null, "magazzino": "AMEDEA_01", "documentoDiTrasporto": "TODO", "nomeFileExcel": "SERIALI_DV_2054109644_6100890470-(a5-ricondizionato).xlsx" }


{ "tipologiaMateriale": "SIM", "statoCaricamento": "RICONDIZIONATO", "tipologiaMovimento":"IN", "produttore": null, "modello": null, "operatore": "WIND", "magazzino": "AMEDEA_01", "documentoDiTrasporto": "TODO", "nomeFileExcel": "WIND IOT AMEDEA-5-ricondizionato.xlsx" }


-- SELECT * FROM POS_UNICO.TIPOLOGIA_POS WHERE TPO_DTINS < to_date('03/06/2024 14:15:53', 'dd/mm/yyyy hh24:mi:ss');



Per un terminale ricondizionato, il seriale deve avere lo stato restituito al fornitore e il modello deve essere uguale a quello da caricare dal file Excel

POS_UNICO.MAGAZZINO_DETTAG_TERMINALI_FK

------------------------------


{
  "errorMessage": "Attribute [it.fastpoint.amedea.api.model.DettaglioMovimentoMagazzino#seriale(BASIC)] is not joinable",
  "errorDescription": "uri=/PosUnicoRestService/pos_unico/api/v1/giacenza/terminali",
  "timestamp": "12/09/2024 18:00:37"
}


CustomDettaglioMovimentoMagazzinoMapper.dettaglioMovimentoMagazzinoToDettaglioMovimentoMagazzinoDto()

JWT_ID
JWT_SECRET_KEY
JWT_ACCESS_TOKEN_EXPIRY_HOURS
JWT_REFRESH_TOKEN_EXPIRY_HOURS

C:\Users\aferreir\git-repo-aws\pos-unico-rest-service\src\main\java\it\fastpoint\amedea\api\utility\BCryptPasswordEncoderUtil.java


it/fastpoint/amedea/api/utility/BCryptPasswordEncoderUtil.java


javac -cp C:\Users\aferreir\.m2\repository\org\springframework\security\spring-security-crypto\6.0.3\spring-security-crypto-6.0.3.jar BCryptPasswordEncoderUtil.java


GiacenzaMagazzinoServiceImpl -> line n. 78



------------------------------------------


SELECT * FROM POS_UNICO.LOG_LAVORAZIONI_UNICA_POS L 
WHERE LU_LAVORAZIONE_KEY = 4 
AND DATA_OPERAZIONE = (SELECT MAX(DATA_OPERAZIONE)
					   FROM POS_UNICO.LOG_LAVORAZIONI_UNICA_POS L2 
					   WHERE L2.LU_LAVORAZIONE_KEY =  L.LU_LAVORAZIONE_KEY);


INSERT INTO POS_UNICO.LOG_LAVORAZIONI_UNICA_POS (
   LU_SOC_CODICE, LU_LAVORAZIONE_KEY, LU_FLUSSO_VENDITA_KEY_REF, 
   LU_TERMID_UNICAPOS, LU_UTENTE_ASSEGNATARIO_KEY, LU_DATA_ASSEGNAZIONE, 
   LU_ANOMALIA_LAVORAZIONE_KEY, LU_TIPOLOGIA_CONFIGURAZIONE, LU_ID_TIPOLOGIA_POS, 
   LU_FLAG_BARCODE_READER, LU_FLAG_ATTIVA_WIFI, LU_FLAG_ATTIVA_LAN, 
   LU_STATO_LAVORAZIONE_POS, LU_NOTE_LAVORAZIONE, LU_DATA_CREAZIONE_LAVORAZIONE, 
   LU_DATA_AGG_LAVORAZIONE, LU_DATA_AGG_STATO_LAVORAZIONE, LU_BARCODE_SPEDIZIONE_POS, 
   VERSION, LU_DATA_TERMINE_LAVORAZIONE, LU_FLAG_EXCHANGE, 
   LU_SPED_SOC_CODICE, LU_SPED_ANNO, LU_SPED_NUMERO, 
   LU_TERMINALE_UNICA_POS_KEY, LU_SIM_TERMINALE_UNICA_POS_KEY, LU_BARCODE_READER_UNI_POS_KEY, 
   OPERAZIONE, DATA_OPERAZIONE, USER_LOG, 
   LU_LOGLAVORAZIONEUNICAPOS_KEY) 
VALUES ( /* LU_SOC_CODICE */,
 /* LU_LAVORAZIONE_KEY */,
 /* LU_FLUSSO_VENDITA_KEY_REF */,
 /* LU_TERMID_UNICAPOS */,
 /* LU_UTENTE_ASSEGNATARIO_KEY */,
 /* LU_DATA_ASSEGNAZIONE */,
 /* LU_ANOMALIA_LAVORAZIONE_KEY */,
 /* LU_TIPOLOGIA_CONFIGURAZIONE */,
 /* LU_ID_TIPOLOGIA_POS */,
 /* LU_FLAG_BARCODE_READER */,
 /* LU_FLAG_ATTIVA_WIFI */,
 /* LU_FLAG_ATTIVA_LAN */,
 /* LU_STATO_LAVORAZIONE_POS */,
 /* LU_NOTE_LAVORAZIONE */,
 /* LU_DATA_CREAZIONE_LAVORAZIONE */,
 /* LU_DATA_AGG_LAVORAZIONE */,
 /* LU_DATA_AGG_STATO_LAVORAZIONE */,
 /* LU_BARCODE_SPEDIZIONE_POS */,
 /* VERSION */,
 /* LU_DATA_TERMINE_LAVORAZIONE */,
 /* LU_FLAG_EXCHANGE */,
 /* LU_SPED_SOC_CODICE */,
 /* LU_SPED_ANNO */,
 /* LU_SPED_NUMERO */,
 /* LU_TERMINALE_UNICA_POS_KEY */,
 /* LU_SIM_TERMINALE_UNICA_POS_KEY */,
 /* LU_BARCODE_READER_UNI_POS_KEY */,
 /* OPERAZIONE */,
 /* DATA_OPERAZIONE */,
 /* USER_LOG */,
 /* LU_LOGLAVORAZIONEUNICAPOS_KEY */ );

findLogLavorazioneUnicaPosByKey() => 
/pos_unico/api/v1/lavorazioneUnicaPos/log/{lavorazioneUnicaPosKey}


http://localhost:8080/PosUnicoRestService/api-docs/swagger-ui/index.html

http://internal-amedea-rest-1916540518.eu-central-1.elb.amazonaws.com:8087/PosUnicoRestService/api-docs/swagger-ui/index.html




